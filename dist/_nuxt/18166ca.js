/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{306:function(e,t,n){"use strict";(function(e,r){n.d(t,"a",(function(){return E})),n.d(t,"b",(function(){return B})),n.d(t,"c",(function(){return h})),n.d(t,"d",(function(){return d})),n.d(t,"e",(function(){return f})),n.d(t,"f",(function(){return m})),n.d(t,"g",(function(){return M})),n.d(t,"h",(function(){return S})),n.d(t,"i",(function(){return w})),n.d(t,"j",(function(){return V})),n.d(t,"k",(function(){return I})),n.d(t,"l",(function(){return G})),n.d(t,"m",(function(){return F})),n.d(t,"n",(function(){return z})),n.d(t,"o",(function(){return N})),n.d(t,"p",(function(){return j})),n.d(t,"q",(function(){return P})),n.d(t,"r",(function(){return L})),n.d(t,"s",(function(){return x})),n.d(t,"t",(function(){return map})),n.d(t,"u",(function(){return U})),n.d(t,"v",(function(){return W})),n.d(t,"w",(function(){return K})),n.d(t,"x",(function(){return $})),n.d(t,"y",(function(){return A})),n.d(t,"z",(function(){return H})),n.d(t,"A",(function(){return Q})),n.d(t,"B",(function(){return Y}));const o=!1,c=!1,l="${JSCORE_VERSION}",h=function(e,t){if(!e)throw d(t)},d=function(e){return new Error("Firebase Database ("+l+") INTERNAL ASSERT FAILED: "+e)},_=function(e){const t=[];let p=0;for(let i=0;i<e.length;i++){let n=e.charCodeAt(i);n<128?t[p++]=n:n<2048?(t[p++]=n>>6|192,t[p++]=63&n|128):55296==(64512&n)&&i+1<e.length&&56320==(64512&e.charCodeAt(i+1))?(n=65536+((1023&n)<<10)+(1023&e.charCodeAt(++i)),t[p++]=n>>18|240,t[p++]=n>>12&63|128,t[p++]=n>>6&63|128,t[p++]=63&n|128):(t[p++]=n>>12|224,t[p++]=n>>6&63|128,t[p++]=63&n|128)}return t},f={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(input,e){if(!Array.isArray(input))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,output=[];for(let i=0;i<input.length;i+=3){const e=input[i],n=i+1<input.length,r=n?input[i+1]:0,o=i+2<input.length,c=o?input[i+2]:0,l=e>>2,h=(3&e)<<4|r>>4;let d=(15&r)<<2|c>>6,_=63&c;o||(_=64,n||(d=64)),output.push(t[l],t[h],t[d],t[_])}return output.join("")},encodeString(input,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(input):this.encodeByteArray(_(input),e)},decodeString(input,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(input):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const o=e[n++];if(o<128)t[r++]=String.fromCharCode(o);else if(o>191&&o<224){const c=e[n++];t[r++]=String.fromCharCode((31&o)<<6|63&c)}else if(o>239&&o<365){const u=((7&o)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(u>>10)),t[r++]=String.fromCharCode(56320+(1023&u))}else{const c=e[n++],l=e[n++];t[r++]=String.fromCharCode((15&o)<<12|(63&c)<<6|63&l)}}return t.join("")}(this.decodeStringToByteArray(input,e))},decodeStringToByteArray(input,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,output=[];for(let i=0;i<input.length;){const e=t[input.charAt(i++)],n=i<input.length?t[input.charAt(i)]:0;++i;const r=i<input.length?t[input.charAt(i)]:64;++i;const o=i<input.length?t[input.charAt(i)]:64;if(++i,null==e||null==n||null==r||null==o)throw Error();const c=e<<2|n>>4;if(output.push(c),64!==r){const e=n<<4&240|r>>2;if(output.push(e),64!==o){const e=r<<6&192|o;output.push(e)}}}return output},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let i=0;i<this.ENCODED_VALS.length;i++)this.byteToCharMap_[i]=this.ENCODED_VALS.charAt(i),this.charToByteMap_[this.byteToCharMap_[i]]=i,this.byteToCharMapWebSafe_[i]=this.ENCODED_VALS_WEBSAFE.charAt(i),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]]=i,i>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)]=i,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)]=i)}}},m=function(e){const t=_(e);return f.encodeByteArray(t,!0)},y=function(e){return m(e).replace(/\./g,"")},v=function(e){try{return f.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function w(e){return C(void 0,e)}function C(e,source){if(!(source instanceof Object))return source;switch(source.constructor){case Date:return new Date(source.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return source}for(const t in source)source.hasOwnProperty(t)&&"__proto__"!==t&&(e[t]=C(e[t],source[t]));return e}const O=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e)return e;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,T=()=>{try{return O()||(()=>{if(void 0===r||void 0===r.env)return;const e=r.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&v(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},I=e=>{const t=(e=>{var t,n;return null===(n=null===(t=T())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]})(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]};class E{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function S(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,sub=e.sub||e.user_id;if(!sub)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:sub,user_id:sub,firebase:{sign_in_provider:"custom",identities:{}}},e);return[y(JSON.stringify({alg:"none",type:"JWT"})),y(JSON.stringify(o)),""].join(".")}function k(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function N(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(k())}function P(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function j(){return!0===o||!0===c}class R extends Error{constructor(code,e,t){super(e),this.code=code,this.customData=t,this.name="FirebaseError",Object.setPrototypeOf(this,R.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ErrorFactory.prototype.create)}}function x(e){return JSON.parse(e)}function A(data){return JSON.stringify(data)}const D=function(e){let header={},t={},data={},n="";try{const r=e.split(".");header=x(v(r[0])||""),t=x(v(r[1])||""),n=r[2],data=t.d||{},delete t.d}catch(e){}return{header:header,claims:t,data:data,signature:n}},L=function(e){const t=D(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},F=function(e){const t=D(e).claims;return"object"==typeof t&&!0===t.admin};function M(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function W(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function z(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function map(e,t,n){const r={};for(const o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=t.call(n,e[o],o,e));return r}function U(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}class B{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let i=1;i<this.blockSize;++i)this.pad_[i]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"==typeof e)for(let i=0;i<16;i++)n[i]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let i=0;i<16;i++)n[i]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let i=16;i<80;i++){const e=n[i-3]^n[i-8]^n[i-14]^n[i-16];n[i]=4294967295&(e<<1|e>>>31)}let r,o,a=this.chain_[0],b=this.chain_[1],c=this.chain_[2],l=this.chain_[3],h=this.chain_[4];for(let i=0;i<80;i++){i<40?i<20?(r=l^b&(c^l),o=1518500249):(r=b^c^l,o=1859775393):i<60?(r=b&c|l&(b|c),o=2400959708):(r=b^c^l,o=3395469782);const e=(a<<5|a>>>27)+r+h+o+n[i]&4294967295;h=l,l=c,c=4294967295&(b<<30|b>>>2),b=a,a=e}this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+b&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+h&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let r=0;const o=this.buf_;let c=this.inbuf_;for(;r<t;){if(0===c)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(o[c]=e.charCodeAt(r),++c,++r,c===this.blockSize){this.compress_(o),c=0;break}}else for(;r<t;)if(o[c]=e[r],++c,++r,c===this.blockSize){this.compress_(o),c=0;break}}this.inbuf_=c,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let i=0;i<5;i++)for(let t=24;t>=0;t-=8)e[n]=this.chain_[i]>>t&255,++n;return e}}const H=function(e,t,n,r){let o;if(r<t?o="at least "+t:r>n&&(o=0===n?"none":"no more than "+n),o){throw new Error(e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+o+".")}};function V(e,t){return`${e} failed: ${t} argument `}function Q(e,t,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(V(e,t)+"must be a valid function.")}function Y(e,t,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(V(e,t)+"must be a valid context object.")}const $=function(e){const t=[];let p=0;for(let i=0;i<e.length;i++){let n=e.charCodeAt(i);if(n>=55296&&n<=56319){const t=n-55296;i++,h(i<e.length,"Surrogate pair missing trail surrogate.");n=65536+(t<<10)+(e.charCodeAt(i)-56320)}n<128?t[p++]=n:n<2048?(t[p++]=n>>6|192,t[p++]=63&n|128):n<65536?(t[p++]=n>>12|224,t[p++]=n>>6&63|128,t[p++]=63&n|128):(t[p++]=n>>18|240,t[p++]=n>>12&63|128,t[p++]=n>>6&63|128,t[p++]=63&n|128)}return t},K=function(e){let p=0;for(let i=0;i<e.length;i++){const t=e.charCodeAt(i);t<128?p++:t<2048?p+=2:t>=55296&&t<=56319?(p+=4,i++):p+=3}return p};function G(e){return e&&e._delegate?e._delegate:e}}).call(this,n(41),n(108))},309:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return h})),n.d(t,"c",(function(){return l}));var r=n(306);class o{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const c="[DEFAULT]";class l{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new r.a;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(component){if(component.name!==this.name)throw Error(`Mismatching Component ${component.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=component,this.shouldAutoInitialize()){if(function(component){return"EAGER"===component.instantiationMode}(component))try{this.getOrInitializeService({instanceIdentifier:c})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=c){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=c){return this.instances.has(e)}getOptions(e=c){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(e)&&t.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),o=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;o.add(e),this.onInitCallbacks.set(r,o);const c=this.instances.get(r);return c&&e(c,r),()=>{o.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===c?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=c){return this.component?this.component.multipleInstances?e:c:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class h{constructor(e){this.name=e,this.providers=new Map}addComponent(component){const e=this.getProvider(component.name);if(e.isComponentSet())throw new Error(`Component ${component.name} has already been registered with ${this.name}`);e.setComponent(component)}addOrOverwriteComponent(component){this.getProvider(component.name).isComponentSet()&&this.providers.delete(component.name),this.addComponent(component)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new l(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},310:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return _}));const r=[];var o;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(o||(o={}));const c={debug:o.DEBUG,verbose:o.VERBOSE,info:o.INFO,warn:o.WARN,error:o.ERROR,silent:o.SILENT},l=o.INFO,h={[o.DEBUG]:"log",[o.VERBOSE]:"log",[o.INFO]:"info",[o.WARN]:"warn",[o.ERROR]:"error"},d=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),o=h[t];if(!o)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[o](`[${r}]  ${e.name}:`,...n)};class _{constructor(e){this.name=e,this._logLevel=l,this._logHandler=d,this._userLogHandler=null,r.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in o))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?c[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,o.DEBUG,...e),this._logHandler(this,o.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,o.VERBOSE,...e),this._logHandler(this,o.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,o.INFO,...e),this._logHandler(this,o.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,o.WARN,...e),this._logHandler(this,o.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,o.ERROR,...e),this._logHandler(this,o.ERROR,...e)}}},318:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return Br})),n.d(t,"b",(function(){return Hr})),n.d(t,"c",(function(){return Et})),n.d(t,"d",(function(){return $r})),n.d(t,"e",(function(){return zs})),n.d(t,"f",(function(){return f})),n.d(t,"g",(function(){return Zi})),n.d(t,"h",(function(){return er})),n.d(t,"i",(function(){return Xr})),n.d(t,"j",(function(){return Qs})),n.d(t,"k",(function(){return Ks})),n.d(t,"l",(function(){return ms})),n.d(t,"m",(function(){return vs})),n.d(t,"n",(function(){return Fs})),n.d(t,"o",(function(){return Vs})),n.d(t,"p",(function(){return Hs})),n.d(t,"q",(function(){return ss})),n.d(t,"r",(function(){return Ys})),n.d(t,"s",(function(){return $s})),n.d(t,"t",(function(){return Xs})),n.d(t,"u",(function(){return Is})),n.d(t,"v",(function(){return Ss})),n.d(t,"w",(function(){return ps})),n.d(t,"x",(function(){return hs})),n.d(t,"y",(function(){return us})),n.d(t,"z",(function(){return ds})),n.d(t,"A",(function(){return _s})),n.d(t,"B",(function(){return ls})),n.d(t,"C",(function(){return Ns})),n.d(t,"D",(function(){return js})),n.d(t,"E",(function(){return xs})),n.d(t,"F",(function(){return Ds})),n.d(t,"G",(function(){return Zr})),n.d(t,"H",(function(){return Ms})),n.d(t,"I",(function(){return Gr})),n.d(t,"J",(function(){return Jr})),n.d(t,"K",(function(){return es})),n.d(t,"L",(function(){return eo})),n.d(t,"M",(function(){return Js})),n.d(t,"N",(function(){return ts})),n.d(t,"O",(function(){return ns})),n.d(t,"P",(function(){return is})),n.d(t,"Q",(function(){return Os})),n.d(t,"R",(function(){return ws})),n.d(t,"S",(function(){return rs}));var r=n(301),o=n(309),c=n(306),l=n(310);const h="@firebase/database",d="0.14.1";let _="";function f(e){_=e}class m{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Object(c.y)(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:Object(c.s)(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class y{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return Object(c.g)(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const v=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new m(t)}}catch(e){}return new y},w=v("localStorage"),C=v("sessionStorage"),O=new l.b("@firebase/database"),T=function(){let e=1;return function(){return e++}}(),I=function(e){const t=Object(c.x)(e),n=new c.b;n.update(t);const r=n.digest();return c.e.encodeByteArray(r)},E=function(...e){let t="";for(let i=0;i<e.length;i++){const n=e[i];Array.isArray(n)||n&&"object"==typeof n&&"number"==typeof n.length?t+=E.apply(null,n):t+="object"==typeof n?Object(c.y)(n):n,t+=" "}return t};let S=null,k=!0;const N=function(e,t){Object(c.c)(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(O.logLevel=l.a.VERBOSE,S=O.log.bind(O),t&&C.set("logging_enabled",!0)):"function"==typeof e?S=e:(S=null,C.remove("logging_enabled"))},P=function(...e){if(!0===k&&(k=!1,null===S&&!0===C.get("logging_enabled")&&N(!0)),S){const t=E.apply(null,e);S(t)}},j=function(e){return function(...t){P(e,...t)}},R=function(...e){const t="FIREBASE INTERNAL ERROR: "+E(...e);O.error(t)},x=function(...e){const t=`FIREBASE FATAL ERROR: ${E(...e)}`;throw O.error(t),new Error(t)},A=function(...e){const t="FIREBASE WARNING: "+E(...e);O.warn(t)},D=function(data){return"number"==typeof data&&(data!=data||data===Number.POSITIVE_INFINITY||data===Number.NEGATIVE_INFINITY)},L="[MIN_NAME]",F="[MAX_NAME]",M=function(a,b){if(a===b)return 0;if(a===L||b===F)return-1;if(b===L||a===F)return 1;{const e=Y(a),t=Y(b);return null!==e?null!==t?e-t==0?a.length-b.length:e-t:-1:null!==t?1:a<b?-1:1}},W=function(a,b){return a===b?0:a<b?-1:1},z=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Object(c.y)(t))},U=function(e){if("object"!=typeof e||null===e)return Object(c.y)(e);const t=[];for(const n in e)t.push(n);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=Object(c.y)(t[i]),n+=":",n+=U(e[t[i]]);return n+="}",n},B=function(e,t){const n=e.length;if(n<=t)return[e];const r=[];for(let o=0;o<n;o+=t)o+t>n?r.push(e.substring(o,n)):r.push(e.substring(o,o+t));return r};function H(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const V=function(e){Object(c.c)(!D(e),"Invalid JSON number");const t=1023;let s,n,r,o,i;0===e?(n=0,r=0,s=1/e==-1/0?1:0):(s=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(o=Math.min(Math.floor(Math.log(e)/Math.LN2),t),n=o+t,r=Math.round(e*Math.pow(2,52-o)-Math.pow(2,52))):(n=0,r=Math.round(e/Math.pow(2,-1074))));const l=[];for(i=52;i;i-=1)l.push(r%2?1:0),r=Math.floor(r/2);for(i=11;i;i-=1)l.push(n%2?1:0),n=Math.floor(n/2);l.push(s?1:0),l.reverse();const h=l.join("");let d="";for(i=0;i<64;i+=8){let e=parseInt(h.substr(i,8),2).toString(16);1===e.length&&(e="0"+e),d+=e}return d.toLowerCase()};const Q=new RegExp("^-?(0*)\\d{1,10}$"),Y=function(e){if(Q.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},$=function(e){try{e()}catch(e){setTimeout((()=>{const t=e.stack||"";throw A("Exception was thrown by user callback.",t),e}),Math.floor(0))}},K=function(e,time){const t=setTimeout(e,time);return"number"==typeof t&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(t):"object"==typeof t&&t.unref&&t.unref(),t};class G{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then((e=>this.appCheck=e))}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise(((t,n)=>{setTimeout((()=>{this.appCheck?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((t=>t.addTokenListener(e)))}notifyForInvalidToken(){A(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class J{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((e=>this.auth_=e))}getToken(e){return this.auth_?this.auth_.getToken(e).catch((e=>e&&"auth/token-not-initialized"===e.code?(P("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e))):new Promise(((t,n)=>{setTimeout((()=>{this.auth_?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((t=>t.addAuthTokenListener(e)))}removeTokenChangeListener(e){this.authProvider_.get().then((t=>t.removeAuthTokenListener(e)))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',A(e)}}class X{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}X.OWNER="owner";const Z="5",ee=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,te="ac",ne="websocket",ie="long_polling";class re{constructor(e,t,n,r,o=!1,c="",l=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=o,this.persistenceKey=c,this.includeNamespaceInQueryParams=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=w.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&w.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function se(e,t,n){let r;if(Object(c.c)("string"==typeof t,"typeof type must == string"),Object(c.c)("object"==typeof n,"typeof params must == object"),t===ne)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==ie)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);const o=[];return H(n,((e,t)=>{o.push(e+"="+t)})),r+o.join("&")}class oe{constructor(){this.counters_={}}incrementCounter(e,t=1){Object(c.g)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Object(c.i)(this.counters_)}}const ae={},ce={};function le(e){const t=e.toString();return ae[t]||(ae[t]=new oe),ae[t]}class he{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,data){for(this.pendingResponses[e]=data;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<e.length;++i)e[i]&&$((()=>{this.onMessage_(e[i])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const ue="start";class de{constructor(e,t,n,r,o,c,l){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=o,this.transportSessionId=c,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=j(e),this.stats_=le(t),this.urlFn=e=>(this.appCheckToken&&(e[te]=this.appCheckToken),se(t,ie,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new he(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if(Object(c.p)()||"complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new _e(((...e)=>{const[t,n,r,o,c]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===ue)this.id=n,this.password=r;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...e)=>{const[t,data]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,data)}),(()=>{this.onClosed_()}),this.urlFn);const e={};e[ue]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v=Z,this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[te]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&ee.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){de.forceAllow_=!0}static forceDisallow(){de.forceDisallow_=!0}static isAvailable(){return!Object(c.p)()&&(!!de.forceAllow_||!(de.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(data){const e=Object(c.y)(data);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const t=Object(c.f)(e),n=B(t,1840);for(let i=0;i<n.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(Object(c.p)())return;this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Object(c.y)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class _e{constructor(e,t,n,r){if(this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,Object(c.p)())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=T(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=_e.createIFrame_();let script="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)){script='<script>document.domain="'+document.domain+'";<\/script>'}const n="<html><body>"+script+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(n),this.myIFrame.doc.close()}catch(e){P("frame writing exception"),e.stack&&P(e.stack),P(e)}}}static createIFrame_(){const iframe=document.createElement("iframe");if(iframe.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(iframe);try{iframe.contentWindow.document||P("No IE domain setting required")}catch(e){const t=document.domain;iframe.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}return iframe.contentDocument?iframe.doc=iframe.contentDocument:iframe.contentWindow?iframe.doc=iframe.contentWindow.document:iframe.document&&(iframe.doc=iframe.document),iframe}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;{const e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,data){this.pendingSegs.push({seg:e,ts:t,d:data}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,(()=>{clearTimeout(r),n()}))}addTag(e,t){Object(c.p)()?this.doNodeLongPoll(e,t):setTimeout((()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{P("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}}),Math.floor(1))}}let pe=null;"undefined"!=typeof MozWebSocket?pe=MozWebSocket:"undefined"!=typeof WebSocket&&(pe=WebSocket);class fe{constructor(e,t,n,r,o,c,l){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=j(this.connId),this.stats_=le(t),this.connURL=fe.connectionURL_(t,c,l,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,o){const l={};return l.v=Z,!Object(c.p)()&&"undefined"!=typeof location&&location.hostname&&ee.test(location.hostname)&&(l.r="f"),t&&(l.s=t),n&&(l.ls=n),r&&(l[te]=r),o&&(l.p=o),se(e,ne,l)}open(t,n){this.onDisconnect=n,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,w.set("previous_websocket_failure",!0);try{let t;if(Object(c.p)()){const n=this.nodeAdmin?"AdminNode":"Node";t={headers:{"User-Agent":`Firebase/${Z}/${_}/${e.platform}/${n}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(t.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(t.headers["X-Firebase-AppCheck"]=this.appCheckToken);const r=e.env,o=0===this.connURL.indexOf("wss://")?r.HTTPS_PROXY||r.https_proxy:r.HTTP_PROXY||r.http_proxy;o&&(t.proxy={origin:o})}this.mySock=new pe(this.connURL,[],t)}catch(e){this.log_("Error instantiating WebSocket.");const t=e.message||e.data;return t&&this.log_(t),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){fe.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==pe&&!fe.forceDisallow_}static previouslyFailed(){return w.isInMemoryStorage||!0===w.get("previous_websocket_failure")}markConnectionHealthy(){w.remove("previous_websocket_failure")}appendFrame_(data){if(this.frames.push(data),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=Object(c.s)(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(data){if(Object(c.c)(null===this.frames,"We already have a frame buffer"),data.length<=6){const e=Number(data);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),data}handleIncomingFrame(e){if(null===this.mySock)return;const data=e.data;if(this.bytesReceived+=data.length,this.stats_.incrementCounter("bytes_received",data.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(data);else{const e=this.extractFrameCount_(data);null!==e&&this.appendFrame_(e)}}send(data){this.resetKeepAlive();const e=Object(c.y)(data);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const t=B(e,16384);t.length>1&&this.sendString_(String(t.length));for(let i=0;i<t.length;i++)this.sendString_(t[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}fe.responsesRequiredToBeHealthy=2,fe.healthyTimeout=3e4;class ge{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[de,fe]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=fe&&fe.isAvailable();let n=t&&!fe.previouslyFailed();if(e.webSocketOnly&&(t||A("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[fe];else{const e=this.transports_=[];for(const t of ge.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);ge.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}ge.globalTransportInitialized_=!1;class me{constructor(e,t,n,r,o,c,l,h,d,_){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=o,this.onMessage_=c,this.onReady_=l,this.onDisconnect_=h,this.onKill_=d,this.lastSessionId=_,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=j("c:"+this.id+":"),this.transportManager_=new ge(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(t,n)}),Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=K((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=z("t",e),data=z("d",e);if("c"===t)this.onSecondaryControl_(data);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(data)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=z("t",e),data=z("d",e);"c"===t?this.onControl_(data):"d"===t&&this.onDataMessage_(data)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=z("t",e);if("d"in e){const n=e.d;if("h"===t)this.onHandshake_(n);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?R("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):R("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Z!==n&&A("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),K((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):K((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(w.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(data){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(data)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class ye{put(e,data,t,n){}merge(e,data,t,n){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,data,t){}onDisconnectMerge(e,data,t){}onDisconnectCancel(e,t){}reportStats(e){}}class ve{constructor(e){this.allowedEvents_=e,this.listeners_={},Object(c.c)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let i=0;i<n.length;i++)n[i].callback.apply(n[i].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)}validateEventType_(e){Object(c.c)(this.allowedEvents_.find((t=>t===e)),"Unknown event: "+e)}}class be extends ve{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Object(c.o)()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}static getInstance(){return new be}getInitialEvent(e){return Object(c.c)("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class we{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[t]=this.pieces_[i],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let i=this.pieceNum_;i<this.pieces_.length;i++)""!==this.pieces_[i]&&(e+="/"+this.pieces_[i]);return e||"/"}}function Ce(){return new we("")}function Oe(path){return path.pieceNum_>=path.pieces_.length?null:path.pieces_[path.pieceNum_]}function Te(path){return path.pieces_.length-path.pieceNum_}function Ie(path){let e=path.pieceNum_;return e<path.pieces_.length&&e++,new we(path.pieces_,e)}function Ee(path){return path.pieceNum_<path.pieces_.length?path.pieces_[path.pieces_.length-1]:null}function Se(path,e=0){return path.pieces_.slice(path.pieceNum_+e)}function ke(path){if(path.pieceNum_>=path.pieces_.length)return null;const e=[];for(let i=path.pieceNum_;i<path.pieces_.length-1;i++)e.push(path.pieces_[i]);return new we(e,0)}function Ne(path,e){const t=[];for(let i=path.pieceNum_;i<path.pieces_.length;i++)t.push(path.pieces_[i]);if(e instanceof we)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{const n=e.split("/");for(let i=0;i<n.length;i++)n[i].length>0&&t.push(n[i])}return new we(t,0)}function Pe(path){return path.pieceNum_>=path.pieces_.length}function je(e,t){const n=Oe(e),r=Oe(t);if(null===n)return t;if(n===r)return je(Ie(e),Ie(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function Re(e,t){const n=Se(e,0),r=Se(t,0);for(let i=0;i<n.length&&i<r.length;i++){const e=M(n[i],r[i]);if(0!==e)return e}return n.length===r.length?0:n.length<r.length?-1:1}function xe(path,e){if(Te(path)!==Te(e))return!1;for(let i=path.pieceNum_,t=e.pieceNum_;i<=path.pieces_.length;i++,t++)if(path.pieces_[i]!==e.pieces_[t])return!1;return!0}function Ae(path,e){let i=path.pieceNum_,t=e.pieceNum_;if(Te(path)>Te(e))return!1;for(;i<path.pieces_.length;){if(path.pieces_[i]!==e.pieces_[t])return!1;++i,++t}return!0}class De{constructor(path,e){this.errorPrefix_=e,this.parts_=Se(path,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=Object(c.w)(this.parts_[i]);Le(this)}}function Le(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+Fe(e))}function Fe(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class Me extends ve{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,(()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))}),!1)}static getInstance(){return new Me}getInitialEvent(e){return Object(c.c)("visible"===e,"Unknown event type: "+e),[this.visible_]}}const qe=1e3;class We extends ye{constructor(e,t,n,r,o,l,h,d){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=o,this.authTokenProvider_=l,this.appCheckTokenProvider_=h,this.authOverride_=d,this.id=We.nextPersistentConnectionId_++,this.log_=j("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=qe,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,d&&!Object(c.p)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Me.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&be.getInstance().on("online",this.onOnline_,this)}sendRequest(e,body,t){const n=++this.requestNumber_,r={r:n,a:e,b:body};this.log_(Object(c.y)(r)),Object(c.c)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),t&&(this.requestCBHash_[n]=t)}get(e){this.initConnection_();const t=new c.a,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,n,r){this.initConnection_();const o=e._queryIdentifier,l=e._path.toString();this.log_("Listen called for "+l+" "+o),this.listens.has(l)||this.listens.set(l,new Map),Object(c.c)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Object(c.c)(!this.listens.get(l).has(o),"listen() called twice for same path/queryId.");const h={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(l).set(o,h),this.connected_&&this.sendListen_(h)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,(n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)}))}sendListen_(e){const t=e.query,n=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+n+" for "+r);const o={p:n};e.tag&&(o.q=t._queryObject,o.t=e.tag),o.h=e.hashFn(),this.sendRequest("q",o,(o=>{const c=o.d,l=o.s;We.warnOnListenWarnings_(c,t);(this.listens.get(n)&&this.listens.get(n).get(r))===e&&(this.log_("listen response",o),"ok"!==l&&this.removeListen_(n,r),e.onComplete&&e.onComplete(l,c))}))}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&Object(c.g)(e,"w")){const n=Object(c.v)(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();A(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||Object(c.m)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=Object(c.r)(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,(t=>{const n=t.s,data=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,data))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(e=>{const t=e.s,data=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,data)}))}unlisten(e,t){const n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),Object(c.c)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const o={p:e};r&&(o.q=n,o.t=r),this.sendRequest("n",o)}onDisconnectPut(e,data,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,data,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:data,onComplete:t})}onDisconnectMerge(e,data,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,data,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:data,onComplete:t})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,data,n){const r={p:t,d:data};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,(e=>{n&&setTimeout((()=>{n(e.s,e.d)}),Math.floor(0))}))}put(e,data,t,n){this.putInternal("p",e,data,t,n)}merge(e,data,t,n){this.putInternal("m",e,data,t,n)}putInternal(e,t,data,n,r){this.initConnection_();const o={p:t,d:data};void 0!==r&&(o.h=r),this.outstandingPuts_.push({action:e,request:o,onComplete:n}),this.outstandingPutCount_++;const c=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(c):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,(n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(n.s,n.d)}))}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,(e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}}))}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Object(c.y)(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,body){this.log_("handleServerMessage",e,body),"d"===e?this.onDataUpdate_(body.p,body.d,!1,body.t):"m"===e?this.onDataUpdate_(body.p,body.d,!0,body.t):"c"===e?this.onListenRevoked_(body.p,body.q):"ac"===e?this.onAuthRevoked_(body.s,body.d):"apc"===e?this.onAppCheckRevoked_(body.s,body.d):"sd"===e?this.onSecurityDebugPacket_(body):R("Unrecognized action received from server: "+Object(c.y)(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Object(c.c)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=qe,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=qe,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=qe),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+We.nextConnectionId_++,o=this.lastSessionId;let l=!1,h=null;const d=function(){h?h.close():(l=!0,n())},_=function(e){Object(c.c)(h,"sendRequest call when we're not connected not allowed."),h.sendRequest(e)};this.realtime_={close:d,sendRequest:_};const f=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[c,d]=await Promise.all([this.authTokenProvider_.getToken(f),this.appCheckTokenProvider_.getToken(f)]);l?P("getToken() completed but was canceled"):(P("getToken() completed. Creating connection."),this.authToken_=c&&c.accessToken,this.appCheckToken_=d&&d.token,h=new me(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,(e=>{A(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),o))}catch(e){this.log_("Failed to get token: "+e),l||(this.repoInfo_.nodeAdmin&&A(e),d())}}}interrupt(e){P("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){P("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Object(c.n)(this.interruptReasons_)&&(this.reconnectDelay_=qe,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let i=0;i<this.outstandingPuts_.length;i++){const e=this.outstandingPuts_[i];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[i],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map((q=>U(q))).join("$"):"default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const n=new we(e).toString();let r;if(this.listens.has(n)){const map=this.listens.get(n);r=map.get(t),map.delete(t),0===map.size&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){P("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){P("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(body){this.securityDebugCallback_?this.securityDebugCallback_(body):"msg"in body&&console.log("FIREBASE: "+body.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let i=0;i<this.outstandingPuts_.length;i++)this.outstandingPuts_[i]&&this.sendPut_(i);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let i=0;i<this.outstandingGets_.length;i++)this.outstandingGets_[i]&&this.sendGet_(i)}sendConnectStats_(){const e={};let t="js";Object(c.p)()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+_.replace(/\./g,"-")]=1,Object(c.o)()?e["framework.cordova"]=1:Object(c.q)()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=be.getInstance().currentlyOnline();return Object(c.n)(this.interruptReasons_)&&e}}We.nextPersistentConnectionId_=0,We.nextConnectionId_=0;class ze{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new ze(e,t)}}class Ue{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new ze(L,e),r=new ze(L,t);return 0!==this.compare(n,r)}minPost(){return ze.MIN}}let Be;class He extends Ue{static get __EMPTY_NODE(){return Be}static set __EMPTY_NODE(e){Be=e}compare(a,b){return M(a.name,b.name)}isDefinedOn(e){throw Object(c.d)("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return ze.MIN}maxPost(){return new ze(F,Be)}makePost(e,t){return Object(c.c)("string"==typeof e,"KeyIndex indexValue must always be a string."),new ze(e,Be)}toString(){return".key"}}const Ve=new He;class Qe{constructor(e,t,n,r,o=null){this.isReverse_=r,this.resultGenerator_=o,this.nodeStack_=[];let c=1;for(;!e.isEmpty();)if(c=t?n(e.key,t):1,r&&(c*=-1),c<0)e=this.isReverse_?e.left:e.right;else{if(0===c){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Ye{constructor(e,t,n,r,o){this.key=e,this.value=t,this.color=null!=n?n:Ye.RED,this.left=null!=r?r:$e.EMPTY_NODE,this.right=null!=o?o:$e.EMPTY_NODE}copy(e,t,n,r,o){return new Ye(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=o?o:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const o=n(e,r.key);return r=o<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===o?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return $e.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return $e.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Ye.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Ye.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Ye.RED=!0,Ye.BLACK=!1;class $e{constructor(e,t=$e.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new $e(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Ye.BLACK,null,null))}remove(e){return new $e(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Ye.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Qe(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Qe(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Qe(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Qe(this.root_,null,this.comparator_,!0,e)}}function Ke(e,t){return M(e.name,t.name)}function Ge(e,t){return M(e,t)}let Je;$e.EMPTY_NODE=new class{copy(e,t,n,r,o){return this}insert(e,t,n){return new Ye(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const Xe=function(e){return"number"==typeof e?"number:"+V(e):"string:"+e},Ze=function(e){if(e.isLeafNode()){const t=e.val();Object(c.c)("string"==typeof t||"number"==typeof t||"object"==typeof t&&Object(c.g)(t,".sv"),"Priority must be a string or number.")}else Object(c.c)(e===Je||e.isEmpty(),"priority of unexpected type.");Object(c.c)(e===Je||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let et,tt,nt;class it{constructor(e,t=it.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,Object(c.c)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Ze(this.priorityNode_)}static set __childrenNodeConstructor(e){et=e}static get __childrenNodeConstructor(){return et}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new it(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:it.__childrenNodeConstructor.EMPTY_NODE}getChild(path){return Pe(path)?this:".priority"===Oe(path)?this.priorityNode_:it.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:it.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(path,e){const t=Oe(path);return null===t?e:e.isEmpty()&&".priority"!==t?this:(Object(c.c)(".priority"!==t||1===Te(path),".priority must be the last token in a path"),this.updateImmediateChild(t,it.__childrenNodeConstructor.EMPTY_NODE.updateChild(Ie(path),e)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Xe(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?V(this.value_):this.value_,this.lazyHash_=I(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===it.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof it.__childrenNodeConstructor?-1:(Object(c.c)(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,r=it.VALUE_TYPE_ORDER.indexOf(t),o=it.VALUE_TYPE_ORDER.indexOf(n);return Object(c.c)(r>=0,"Unknown leaf type: "+t),Object(c.c)(o>=0,"Unknown leaf type: "+n),r===o?"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:o-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}it.VALUE_TYPE_ORDER=["object","boolean","number","string"];const st=new class extends Ue{compare(a,b){const e=a.node.getPriority(),t=b.node.getPriority(),n=e.compareTo(t);return 0===n?M(a.name,b.name):n}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return ze.MIN}maxPost(){return new ze(F,new it("[PRIORITY-POST]",nt))}makePost(e,t){const n=tt(e);return new ze(t,new it("[PRIORITY-POST]",n))}toString(){return".priority"}},ot=Math.log(2);class at{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/ot,10)),this.current_=this.count-1;const mask=(n=this.count,parseInt(Array(n+1).join("1"),2));var n;this.bits_=e+1&mask}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const ct=function(e,t,n,r){e.sort(t);const o=function(t,r){const c=r-t;let l,h;if(0===c)return null;if(1===c)return l=e[t],h=n?n(l):l,new Ye(h,l.node,Ye.BLACK,null,null);{const d=parseInt(c/2,10)+t,_=o(t,d),f=o(d+1,r);return l=e[d],h=n?n(l):l,new Ye(h,l.node,Ye.BLACK,_,f)}},c=function(t){let r=null,c=null,l=e.length;const h=function(t,r){const c=l-t,h=l;l-=t;const _=o(c+1,h),f=e[c],m=n?n(f):f;d(new Ye(m,f.node,r,null,_))},d=function(e){r?(r.left=e,r=e):(c=e,r=e)};for(let i=0;i<t.count;++i){const e=t.nextBitIsOne(),n=Math.pow(2,t.count-(i+1));e?h(n,Ye.BLACK):(h(n,Ye.BLACK),h(n,Ye.RED))}return c}(new at(e.length));return new $e(r||t,c)};let lt;const ht={};class ut{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return Object(c.c)(ht&&st,"ChildrenNode.ts has not been loaded"),lt=lt||new ut({".priority":ht},{".priority":st}),lt}get(e){const t=Object(c.v)(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof $e?t:null}hasIndex(e){return Object(c.g)(this.indexSet_,e.toString())}addIndex(e,t){Object(c.c)(e!==Ve,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const o=t.getIterator(ze.Wrap);let l,h=o.getNext();for(;h;)r=r||e.isDefinedOn(h.node),n.push(h),h=o.getNext();l=r?ct(n,e.getCompare()):ht;const d=e.toString(),_=Object.assign({},this.indexSet_);_[d]=e;const f=Object.assign({},this.indexes_);return f[d]=l,new ut(f,_)}addToIndexes(e,t){const n=Object(c.t)(this.indexes_,((n,r)=>{const o=Object(c.v)(this.indexSet_,r);if(Object(c.c)(o,"Missing index implementation for "+r),n===ht){if(o.isDefinedOn(e.node)){const n=[],r=t.getIterator(ze.Wrap);let c=r.getNext();for(;c;)c.name!==e.name&&n.push(c),c=r.getNext();return n.push(e),ct(n,o.getCompare())}return ht}{const r=t.get(e.name);let o=n;return r&&(o=o.remove(new ze(e.name,r))),o.insert(e,e.node)}}));return new ut(n,this.indexSet_)}removeFromIndexes(e,t){const n=Object(c.t)(this.indexes_,(n=>{if(n===ht)return n;{const r=t.get(e.name);return r?n.remove(new ze(e.name,r)):n}}));return new ut(n,this.indexSet_)}}let _t;class pt{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Ze(this.priorityNode_),this.children_.isEmpty()&&Object(c.c)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return _t||(_t=new pt(new $e(Ge),null,ut.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||_t}updatePriority(e){return this.children_.isEmpty()?this:new pt(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?_t:t}}getChild(path){const e=Oe(path);return null===e?this:this.getImmediateChild(e).getChild(Ie(path))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(Object(c.c)(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const n=new ze(e,t);let r,o;t.isEmpty()?(r=this.children_.remove(e),o=this.indexMap_.removeFromIndexes(n,this.children_)):(r=this.children_.insert(e,t),o=this.indexMap_.addToIndexes(n,this.children_));const c=r.isEmpty()?_t:this.priorityNode_;return new pt(r,c,o)}}updateChild(path,e){const t=Oe(path);if(null===t)return e;{Object(c.c)(".priority"!==Oe(path)||1===Te(path),".priority must be the last token in a path");const n=this.getImmediateChild(t).updateChild(Ie(path),e);return this.updateImmediateChild(t,n)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,r=0,o=!0;if(this.forEachChild(st,((c,l)=>{t[c]=l.val(e),n++,o&&pt.INTEGER_REGEXP_.test(c)?r=Math.max(r,Number(c)):o=!1})),!e&&o&&r<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+Xe(this.getPriority().val())+":"),this.forEachChild(st,((t,n)=>{const r=n.hash();""!==r&&(e+=":"+t+":"+r)})),this.lazyHash_=""===e?"":I(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){const n=r.getPredecessorKey(new ze(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new ze(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new ze(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal((e=>t(e.name,e.node))):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(e=>e));{const n=this.children_.getIteratorFrom(e.name,ze.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)<0;)n.getNext(),r=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(e=>e));{const n=this.children_.getReverseIteratorFrom(e.name,ze.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)>0;)n.getNext(),r=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===ft?-1:0}withIndex(e){if(e===Ve||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new pt(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Ve||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(st),n=t.getIterator(st);let r=e.getNext(),o=n.getNext();for(;r&&o;){if(r.name!==o.name||!r.node.equals(o.node))return!1;r=e.getNext(),o=n.getNext()}return null===r&&null===o}return!1}return!1}}resolveIndex_(e){return e===Ve?null:this.indexMap_.get(e.toString())}}pt.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const ft=new class extends pt{constructor(){super(new $e(Ge),pt.EMPTY_NODE,ut.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return pt.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(ze,{MIN:{value:new ze(L,pt.EMPTY_NODE)},MAX:{value:new ze(F,ft)}}),He.__EMPTY_NODE=pt.EMPTY_NODE,it.__childrenNodeConstructor=pt,Je=ft,function(e){nt=e}(ft);function gt(e,t=null){if(null===e)return pt.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),Object(c.c)(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e){return new it(e,gt(t))}if(e instanceof Array){let n=pt.EMPTY_NODE;return H(e,((t,r)=>{if(Object(c.g)(e,t)&&"."!==t.substring(0,1)){const e=gt(r);!e.isLeafNode()&&e.isEmpty()||(n=n.updateImmediateChild(t,e))}})),n.updatePriority(gt(t))}{const n=[];let r=!1;if(H(e,((e,t)=>{if("."!==e.substring(0,1)){const o=gt(t);o.isEmpty()||(r=r||!o.getPriority().isEmpty(),n.push(new ze(e,o)))}})),0===n.length)return pt.EMPTY_NODE;const o=ct(n,Ke,(e=>e.name),Ge);if(r){const e=ct(n,st.getCompare());return new pt(o,gt(t),new ut({".priority":e},{".priority":st}))}return new pt(o,gt(t),ut.Default)}}!function(e){tt=e}(gt);class mt extends Ue{constructor(e){super(),this.indexPath_=e,Object(c.c)(!Pe(e)&&".priority"!==Oe(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(a,b){const e=this.extractChild(a.node),t=this.extractChild(b.node),n=e.compareTo(t);return 0===n?M(a.name,b.name):n}makePost(e,t){const n=gt(e),r=pt.EMPTY_NODE.updateChild(this.indexPath_,n);return new ze(t,r)}maxPost(){const e=pt.EMPTY_NODE.updateChild(this.indexPath_,ft);return new ze(F,e)}toString(){return Se(this.indexPath_,0).join("/")}}const yt=new class extends Ue{compare(a,b){const e=a.node.compareTo(b.node);return 0===e?M(a.name,b.name):e}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return ze.MIN}maxPost(){return ze.MAX}makePost(e,t){const n=gt(e);return new ze(t,n)}toString(){return".value"}};function vt(e){return{type:"value",snapshotNode:e}}function bt(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function wt(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Ct(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class Ot{constructor(e){this.index_=e}updateChild(e,t,n,r,source,o){Object(c.c)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const l=e.getImmediateChild(t);return l.getChild(r).equals(n.getChild(r))&&l.isEmpty()===n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(wt(t,l)):Object(c.c)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?o.trackChildChange(bt(t,n)):o.trackChildChange(Ct(t,n,l))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(st,((e,r)=>{t.hasChild(e)||n.trackChildChange(wt(e,r))})),t.isLeafNode()||t.forEachChild(st,((t,r)=>{if(e.hasChild(t)){const o=e.getImmediateChild(t);o.equals(r)||n.trackChildChange(Ct(t,r,o))}else n.trackChildChange(bt(t,r))}))),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?pt.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class Tt{constructor(e){this.indexedFilter_=new Ot(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Tt.getStartPost_(e),this.endPost_=Tt.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,r,source,o){return this.matches(new ze(t,n))||(n=pt.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,source,o)}updateFullNode(e,t,n){t.isLeafNode()&&(t=pt.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(pt.EMPTY_NODE);const o=this;return t.forEachChild(st,((e,t)=>{o.matches(new ze(e,t))||(r=r.updateImmediateChild(e,pt.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class It{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{const t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new Tt(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,r,source,o){return this.rangedFilter_.matches(new ze(t,n))||(n=pt.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,source,o):this.fullLimitUpdateChild_(e,t,n,source,o)}updateFullNode(e,t,n){let r;if(t.isLeafNode()||t.isEmpty())r=pt.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;r=pt.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){const t=e.getNext();if(this.withinDirectionalStart(t)){if(!this.withinDirectionalEnd(t))break;r=r.updateImmediateChild(t.name,t.node),n++}}}else{let e;r=t.withIndex(this.index_),r=r.updatePriority(pt.EMPTY_NODE),e=this.reverse_?r.getReverseIterator(this.index_):r.getIterator(this.index_);let n=0;for(;e.hasNext();){const t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:r=r.updateImmediateChild(t.name,pt.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,source,r){let o;if(this.reverse_){const e=this.index_.getCompare();o=(a,b)=>e(b,a)}else o=this.index_.getCompare();const l=e;Object(c.c)(l.numChildren()===this.limit_,"");const h=new ze(t,n),d=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),_=this.rangedFilter_.matches(h);if(l.hasChild(t)){const e=l.getImmediateChild(t);let c=source.getChildAfterChild(this.index_,d,this.reverse_);for(;null!=c&&(c.name===t||l.hasChild(c.name));)c=source.getChildAfterChild(this.index_,c,this.reverse_);const f=null==c?1:o(c,h);if(_&&!n.isEmpty()&&f>=0)return null!=r&&r.trackChildChange(Ct(t,n,e)),l.updateImmediateChild(t,n);{null!=r&&r.trackChildChange(wt(t,e));const n=l.updateImmediateChild(t,pt.EMPTY_NODE);return null!=c&&this.rangedFilter_.matches(c)?(null!=r&&r.trackChildChange(bt(c.name,c.node)),n.updateImmediateChild(c.name,c.node)):n}}return n.isEmpty()?e:_&&o(d,h)>=0?(null!=r&&(r.trackChildChange(wt(d.name,d.node)),r.trackChildChange(bt(t,n))),l.updateImmediateChild(t,n).updateImmediateChild(d.name,pt.EMPTY_NODE)):e}}class Et{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=st}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return Object(c.c)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Object(c.c)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:L}hasEnd(){return this.endSet_}getIndexEndValue(){return Object(c.c)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Object(c.c)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:F}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return Object(c.c)(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===st}copy(){const e=new Et;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function St(e,t,n){const r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function kt(e,t,n){const r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function Nt(e,t){const n=e.copy();return n.index_=t,n}function Pt(e){const t={};if(e.isDefault())return t;let n;if(e.index_===st?n="$priority":e.index_===yt?n="$value":e.index_===Ve?n="$key":(Object(c.c)(e.index_ instanceof mt,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=Object(c.y)(n),e.startSet_){const n=e.startAfterSet_?"startAfter":"startAt";t[n]=Object(c.y)(e.indexStartValue_),e.startNameSet_&&(t[n]+=","+Object(c.y)(e.indexStartName_))}if(e.endSet_){const n=e.endBeforeSet_?"endBefore":"endAt";t[n]=Object(c.y)(e.indexEndValue_),e.endNameSet_&&(t[n]+=","+Object(c.y)(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function jt(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==st&&(t.i=e.index_.toString()),t}class Rt extends ye{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=j("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(Object(c.c)(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,r){const o=e._path.toString();this.log_("Listen called for "+o+" "+e._queryIdentifier);const l=Rt.getListenId_(e,n),h={};this.listens_[l]=h;const d=Pt(e._queryParams);this.restRequest_(o+".json",d,((e,t)=>{let data=t;if(404===e&&(data=null,e=null),null===e&&this.onDataUpdate_(o,data,!1,n),Object(c.v)(this.listens_,l)===h){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",r(t,null)}}))}unlisten(e,t){const n=Rt.getListenId_(e,t);delete this.listens_[n]}get(e){const t=Pt(e._queryParams),n=e._path.toString(),r=new c.a;return this.restRequest_(n+".json",t,((e,t)=>{let data=t;404===e&&(data=null,e=null),null===e?(this.onDataUpdate_(n,data,!1,null),r.resolve(data)):r.reject(new Error(data))})),r.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([r,o])=>{r&&r.accessToken&&(t.auth=r.accessToken),o&&o.token&&(t.ac=o.token);const l=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Object(c.u)(t);this.log_("Sending REST request for "+l);const h=new XMLHttpRequest;h.onreadystatechange=()=>{if(n&&4===h.readyState){this.log_("REST Response for "+l+" received. status:",h.status,"response:",h.responseText);let e=null;if(h.status>=200&&h.status<300){try{e=Object(c.s)(h.responseText)}catch(e){A("Failed to parse JSON response for "+l+": "+h.responseText)}n(null,e)}else 401!==h.status&&404!==h.status&&A("Got unsuccessful REST response for "+l+" Status: "+h.status),n(h.status);n=null}},h.open("GET",l,!0),h.send()}))}}class xt{constructor(){this.rootNode_=pt.EMPTY_NODE}getNode(path){return this.rootNode_.getChild(path)}updateSnapshot(path,e){this.rootNode_=this.rootNode_.updateChild(path,e)}}function At(){return{value:null,children:new Map}}function Dt(e,path,data){if(Pe(path))e.value=data,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(path,data);else{const t=Oe(path);e.children.has(t)||e.children.set(t,At());Dt(e.children.get(t),path=Ie(path),data)}}function Lt(e,path){if(Pe(path))return e.value=null,e.children.clear(),!0;if(null!==e.value){if(e.value.isLeafNode())return!1;{const t=e.value;return e.value=null,t.forEachChild(st,((t,n)=>{Dt(e,new we(t),n)})),Lt(e,path)}}if(e.children.size>0){const t=Oe(path);if(path=Ie(path),e.children.has(t)){Lt(e.children.get(t),path)&&e.children.delete(t)}return 0===e.children.size}return!0}function Ft(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach(((e,n)=>{t(n,e)}))}(e,((e,r)=>{Ft(r,new we(t.toString()+"/"+e),n)}))}class Mt{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&H(this.last_,((e,n)=>{t[e]=t[e]-n})),this.last_=e,t}}class qt{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Mt(e);const n=1e4+2e4*Math.random();K(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;H(e,((e,r)=>{r>0&&Object(c.g)(this.statsToReport_,e)&&(t[e]=r,n=!0)})),n&&this.server_.reportStats(t),K(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var Wt;function zt(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(Wt||(Wt={}));class Ut{constructor(path,e,t){this.path=path,this.affectedTree=e,this.revert=t,this.type=Wt.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(Pe(this.path)){if(null!=this.affectedTree.value)return Object(c.c)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new we(e));return new Ut(Ce(),t,this.revert)}}return Object(c.c)(Oe(this.path)===e,"operationForChild called for unrelated child."),new Ut(Ie(this.path),this.affectedTree,this.revert)}}class Bt{constructor(source,path){this.source=source,this.path=path,this.type=Wt.LISTEN_COMPLETE}operationForChild(e){return Pe(this.path)?new Bt(this.source,Ce()):new Bt(this.source,Ie(this.path))}}class Ht{constructor(source,path,e){this.source=source,this.path=path,this.snap=e,this.type=Wt.OVERWRITE}operationForChild(e){return Pe(this.path)?new Ht(this.source,Ce(),this.snap.getImmediateChild(e)):new Ht(this.source,Ie(this.path),this.snap)}}class Vt{constructor(source,path,e){this.source=source,this.path=path,this.children=e,this.type=Wt.MERGE}operationForChild(e){if(Pe(this.path)){const t=this.children.subtree(new we(e));return t.isEmpty()?null:t.value?new Ht(this.source,Ce(),t.value):new Vt(this.source,Ce(),t)}return Object(c.c)(Oe(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Vt(this.source,Ie(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Qt{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(path){if(Pe(path))return this.isFullyInitialized()&&!this.filtered_;const e=Oe(path);return this.isCompleteForChild(e)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class Yt{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function $t(e,t,n,r,o,l){const h=r.filter((e=>e.type===n));h.sort(((a,b)=>function(e,a,b){if(null==a.childName||null==b.childName)throw Object(c.d)("Should only compare child_ events.");const t=new ze(a.childName,a.snapshotNode),n=new ze(b.childName,b.snapshotNode);return e.index_.compare(t,n)}(e,a,b))),h.forEach((n=>{const r=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,l);o.forEach((o=>{o.respondsTo(n.type)&&t.push(o.createEvent(r,e.query_))}))}))}function Kt(e,t){return{eventCache:e,serverCache:t}}function Gt(e,t,n,r){return Kt(new Qt(t,n,r),e.serverCache)}function Jt(e,t,n,r){return Kt(e.eventCache,new Qt(t,n,r))}function Xt(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Zt(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let en;class tn{constructor(e,t=(()=>(en||(en=new $e(W)),en))()){this.value=e,this.children=t}static fromObject(e){let t=new tn(null);return H(e,((e,n)=>{t=t.set(new we(e),n)})),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:Ce(),value:this.value};if(Pe(e))return null;{const n=Oe(e),r=this.children.get(n);if(null!==r){const o=r.findRootMostMatchingPathAndValue(Ie(e),t);if(null!=o){return{path:Ne(new we(n),o.path),value:o.value}}return null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,(()=>!0))}subtree(e){if(Pe(e))return this;{const t=Oe(e),n=this.children.get(t);return null!==n?n.subtree(Ie(e)):new tn(null)}}set(e,t){if(Pe(e))return new tn(t,this.children);{const n=Oe(e),r=(this.children.get(n)||new tn(null)).set(Ie(e),t),o=this.children.insert(n,r);return new tn(this.value,o)}}remove(e){if(Pe(e))return this.children.isEmpty()?new tn(null):new tn(null,this.children);{const t=Oe(e),n=this.children.get(t);if(n){const r=n.remove(Ie(e));let o;return o=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&o.isEmpty()?new tn(null):new tn(this.value,o)}return this}}get(e){if(Pe(e))return this.value;{const t=Oe(e),n=this.children.get(t);return n?n.get(Ie(e)):null}}setTree(e,t){if(Pe(e))return t;{const n=Oe(e),r=(this.children.get(n)||new tn(null)).setTree(Ie(e),t);let o;return o=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new tn(this.value,o)}}fold(e){return this.fold_(Ce(),e)}fold_(e,t){const n={};return this.children.inorderTraversal(((r,o)=>{n[r]=o.fold_(Ne(e,r),t)})),t(e,this.value,n)}findOnPath(path,e){return this.findOnPath_(path,Ce(),e)}findOnPath_(e,t,n){const r=!!this.value&&n(t,this.value);if(r)return r;if(Pe(e))return null;{const r=Oe(e),o=this.children.get(r);return o?o.findOnPath_(Ie(e),Ne(t,r),n):null}}foreachOnPath(path,e){return this.foreachOnPath_(path,Ce(),e)}foreachOnPath_(e,t,n){if(Pe(e))return this;{this.value&&n(t,this.value);const r=Oe(e),o=this.children.get(r);return o?o.foreachOnPath_(Ie(e),Ne(t,r),n):new tn(null)}}foreach(e){this.foreach_(Ce(),e)}foreach_(e,t){this.children.inorderTraversal(((n,r)=>{r.foreach_(Ne(e,n),t)})),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal(((t,n)=>{n.value&&e(t,n.value)}))}}class nn{constructor(e){this.writeTree_=e}static empty(){return new nn(new tn(null))}}function rn(e,path,t){if(Pe(path))return new nn(new tn(t));{const n=e.writeTree_.findRootMostValueAndPath(path);if(null!=n){const r=n.path;let o=n.value;const c=je(r,path);return o=o.updateChild(c,t),new nn(e.writeTree_.set(r,o))}{const n=new tn(t),r=e.writeTree_.setTree(path,n);return new nn(r)}}}function sn(e,path,t){let n=e;return H(t,((e,t)=>{n=rn(n,Ne(path,e),t)})),n}function on(e,path){if(Pe(path))return nn.empty();{const t=e.writeTree_.setTree(path,new tn(null));return new nn(t)}}function an(e,path){return null!=cn(e,path)}function cn(e,path){const t=e.writeTree_.findRootMostValueAndPath(path);return null!=t?e.writeTree_.get(t.path).getChild(je(t.path,path)):null}function ln(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(st,((e,n)=>{t.push(new ze(e,n))})):e.writeTree_.children.inorderTraversal(((e,n)=>{null!=n.value&&t.push(new ze(e,n.value))})),t}function hn(e,path){if(Pe(path))return e;{const t=cn(e,path);return new nn(null!=t?new tn(t):e.writeTree_.subtree(path))}}function un(e){return e.writeTree_.isEmpty()}function dn(e,t){return _n(Ce(),e.writeTree_,t)}function _n(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let r=null;return t.children.inorderTraversal(((t,o)=>{".priority"===t?(Object(c.c)(null!==o.value,"Priority writes must always be leaf nodes"),r=o.value):n=_n(Ne(e,t),o,n)})),n.getChild(e).isEmpty()||null===r||(n=n.updateChild(Ne(e,".priority"),r)),n}}function pn(e,path){return Sn(path,e)}function fn(e,t){const n=e.allWrites.findIndex((s=>s.writeId===t));Object(c.c)(n>=0,"removeWrite called with nonexistent writeId.");const r=e.allWrites[n];e.allWrites.splice(n,1);let o=r.visible,l=!1,i=e.allWrites.length-1;for(;o&&i>=0;){const t=e.allWrites[i];t.visible&&(i>=n&&gn(t,r.path)?o=!1:Ae(r.path,t.path)&&(l=!0)),i--}if(o){if(l)return function(e){e.visibleWrites=yn(e.allWrites,mn,Ce()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;if(r.snap)e.visibleWrites=on(e.visibleWrites,r.path);else{H(r.children,(t=>{e.visibleWrites=on(e.visibleWrites,Ne(r.path,t))}))}return!0}return!1}function gn(e,path){if(e.snap)return Ae(e.path,path);for(const t in e.children)if(e.children.hasOwnProperty(t)&&Ae(Ne(e.path,t),path))return!0;return!1}function mn(e){return e.visible}function yn(e,filter,t){let n=nn.empty();for(let i=0;i<e.length;++i){const r=e[i];if(filter(r)){const e=r.path;let o;if(r.snap)Ae(t,e)?(o=je(t,e),n=rn(n,o,r.snap)):Ae(e,t)&&(o=je(e,t),n=rn(n,Ce(),r.snap.getChild(o)));else{if(!r.children)throw Object(c.d)("WriteRecord should have .snap or .children");if(Ae(t,e))o=je(t,e),n=sn(n,o,r.children);else if(Ae(e,t))if(o=je(e,t),Pe(o))n=sn(n,Ce(),r.children);else{const e=Object(c.v)(r.children,Oe(o));if(e){const t=e.getChild(Ie(o));n=rn(n,Ce(),t)}}}}}return n}function vn(e,t,n,r,o){if(r||o){const c=hn(e.visibleWrites,t);if(!o&&un(c))return n;if(o||null!=n||an(c,Ce())){const filter=function(e){return(e.visible||o)&&(!r||!~r.indexOf(e.writeId))&&(Ae(e.path,t)||Ae(t,e.path))};return dn(yn(e.allWrites,filter,t),n||pt.EMPTY_NODE)}return null}{const r=cn(e.visibleWrites,t);if(null!=r)return r;{const r=hn(e.visibleWrites,t);if(un(r))return n;if(null!=n||an(r,Ce())){return dn(r,n||pt.EMPTY_NODE)}return null}}}function bn(e,t,n,r){return vn(e.writeTree,e.treePath,t,n,r)}function wn(e,t){return function(e,t,n){let r=pt.EMPTY_NODE;const o=cn(e.visibleWrites,t);if(o)return o.isLeafNode()||o.forEachChild(st,((e,t)=>{r=r.updateImmediateChild(e,t)})),r;if(n){const o=hn(e.visibleWrites,t);return n.forEachChild(st,((e,t)=>{const n=dn(hn(o,new we(e)),t);r=r.updateImmediateChild(e,n)})),ln(o).forEach((e=>{r=r.updateImmediateChild(e.name,e.node)})),r}return ln(hn(e.visibleWrites,t)).forEach((e=>{r=r.updateImmediateChild(e.name,e.node)})),r}(e.writeTree,e.treePath,t)}function Cn(e,path,t,n){return function(e,t,n,r,o){Object(c.c)(r||o,"Either existingEventSnap or existingServerSnap must exist");const path=Ne(t,n);if(an(e.visibleWrites,path))return null;{const t=hn(e.visibleWrites,path);return un(t)?o.getChild(n):dn(t,o.getChild(n))}}(e.writeTree,e.treePath,path,t,n)}function On(e,path){return function(e,path){return cn(e.visibleWrites,path)}(e.writeTree,Ne(e.treePath,path))}function Tn(e,t,n,r,o,c){return function(e,t,n,r,o,c,l){let h;const d=hn(e.visibleWrites,t),_=cn(d,Ce());if(null!=_)h=_;else{if(null==n)return[];h=dn(d,n)}if(h=h.withIndex(l),h.isEmpty()||h.isLeafNode())return[];{const e=[],t=l.getCompare(),n=c?h.getReverseIteratorFrom(r,l):h.getIteratorFrom(r,l);let d=n.getNext();for(;d&&e.length<o;)0!==t(d,r)&&e.push(d),d=n.getNext();return e}}(e.writeTree,e.treePath,t,n,r,o,c)}function In(e,t,n){return function(e,t,n,r){const path=Ne(t,n),o=cn(e.visibleWrites,path);if(null!=o)return o;if(r.isCompleteForChild(n))return dn(hn(e.visibleWrites,path),r.getNode().getImmediateChild(n));return null}(e.writeTree,e.treePath,t,n)}function En(e,t){return Sn(Ne(e.treePath,t),e.writeTree)}function Sn(path,e){return{treePath:path,writeTree:e}}class kn{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;Object(c.c)("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),Object(c.c)(".priority"!==n,"Only non-priority child changes can be tracked.");const r=this.changeMap.get(n);if(r){const o=r.type;if("child_added"===t&&"child_removed"===o)this.changeMap.set(n,Ct(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===o)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===o)this.changeMap.set(n,wt(n,r.oldSnap));else if("child_changed"===t&&"child_added"===o)this.changeMap.set(n,bt(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==o)throw Object(c.d)("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,Ct(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const Nn=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class Pn{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new Qt(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return In(this.writes_,e,t)}}getChildAfterChild(e,t,n){const r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Zt(this.viewCache_),o=Tn(this.writes_,r,t,1,n,e);return 0===o.length?null:o[0]}}function jn(e,t,n,r,o){const l=new kn;let h,d;if(n.type===Wt.OVERWRITE){const _=n;_.source.fromUser?h=An(e,t,_.path,_.snap,r,o,l):(Object(c.c)(_.source.fromServer,"Unknown source."),d=_.source.tagged||t.serverCache.isFiltered()&&!Pe(_.path),h=xn(e,t,_.path,_.snap,r,o,d,l))}else if(n.type===Wt.MERGE){const _=n;_.source.fromUser?h=function(e,t,path,n,r,o,c){let l=t;return n.foreach(((n,h)=>{const d=Ne(path,n);Dn(t,Oe(d))&&(l=An(e,l,d,h,r,o,c))})),n.foreach(((n,h)=>{const d=Ne(path,n);Dn(t,Oe(d))||(l=An(e,l,d,h,r,o,c))})),l}(e,t,_.path,_.children,r,o,l):(Object(c.c)(_.source.fromServer,"Unknown source."),d=_.source.tagged||t.serverCache.isFiltered(),h=Fn(e,t,_.path,_.children,r,o,d,l))}else if(n.type===Wt.ACK_USER_WRITE){const d=n;h=d.revert?function(e,t,path,n,r,o){let l;if(null!=On(n,path))return t;{const source=new Pn(n,t,r),h=t.eventCache.getNode();let d;if(Pe(path)||".priority"===Oe(path)){let r;if(t.serverCache.isFullyInitialized())r=bn(n,Zt(t));else{const e=t.serverCache.getNode();Object(c.c)(e instanceof pt,"serverChildren would be complete if leaf node"),r=wn(n,e)}d=e.filter.updateFullNode(h,r,o)}else{const r=Oe(path);let c=In(n,r,t.serverCache);null==c&&t.serverCache.isCompleteForChild(r)&&(c=h.getImmediateChild(r)),d=null!=c?e.filter.updateChild(h,r,c,Ie(path),source,o):t.eventCache.getNode().hasChild(r)?e.filter.updateChild(h,r,pt.EMPTY_NODE,Ie(path),source,o):h,d.isEmpty()&&t.serverCache.isFullyInitialized()&&(l=bn(n,Zt(t)),l.isLeafNode()&&(d=e.filter.updateFullNode(d,l,o)))}return l=t.serverCache.isFullyInitialized()||null!=On(n,Ce()),Gt(t,d,l,e.filter.filtersNodes())}}(e,t,d.path,r,o,l):function(e,t,n,r,o,c,l){if(null!=On(o,n))return t;const h=t.serverCache.isFiltered(),d=t.serverCache;if(null!=r.value){if(Pe(n)&&d.isFullyInitialized()||d.isCompleteForPath(n))return xn(e,t,n,d.getNode().getChild(n),o,c,h,l);if(Pe(n)){let r=new tn(null);return d.getNode().forEachChild(Ve,((e,t)=>{r=r.set(new we(e),t)})),Fn(e,t,n,r,o,c,h,l)}return t}{let _=new tn(null);return r.foreach(((e,t)=>{const r=Ne(n,e);d.isCompleteForPath(r)&&(_=_.set(e,d.getNode().getChild(r)))})),Fn(e,t,n,_,o,c,h,l)}}(e,t,d.path,d.affectedTree,r,o,l)}else{if(n.type!==Wt.LISTEN_COMPLETE)throw Object(c.d)("Unknown operation type: "+n.type);h=function(e,t,path,n,r){const o=t.serverCache,c=Jt(t,o.getNode(),o.isFullyInitialized()||Pe(path),o.isFiltered());return Rn(e,c,path,n,Nn,r)}(e,t,n.path,r,l)}const _=l.getChanges();return function(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){const o=r.getNode().isLeafNode()||r.getNode().isEmpty(),c=Xt(e);(n.length>0||!e.eventCache.isFullyInitialized()||o&&!r.getNode().equals(c)||!r.getNode().getPriority().equals(c.getPriority()))&&n.push(vt(Xt(t)))}}(t,h,_),{viewCache:h,changes:_}}function Rn(e,t,n,r,source,o){const l=t.eventCache;if(null!=On(r,n))return t;{let h,d;if(Pe(n))if(Object(c.c)(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=Zt(t),c=wn(r,n instanceof pt?n:pt.EMPTY_NODE);h=e.filter.updateFullNode(t.eventCache.getNode(),c,o)}else{const n=bn(r,Zt(t));h=e.filter.updateFullNode(t.eventCache.getNode(),n,o)}else{const _=Oe(n);if(".priority"===_){Object(c.c)(1===Te(n),"Can't have a priority with additional path components");const o=l.getNode();d=t.serverCache.getNode();const _=Cn(r,n,o,d);h=null!=_?e.filter.updatePriority(o,_):l.getNode()}else{const c=Ie(n);let f;if(l.isCompleteForChild(_)){d=t.serverCache.getNode();const e=Cn(r,n,l.getNode(),d);f=null!=e?l.getNode().getImmediateChild(_).updateChild(c,e):l.getNode().getImmediateChild(_)}else f=In(r,_,t.serverCache);h=null!=f?e.filter.updateChild(l.getNode(),_,f,c,source,o):l.getNode()}}return Gt(t,h,l.isFullyInitialized()||Pe(n),e.filter.filtersNodes())}}function xn(e,t,n,r,o,c,l,h){const d=t.serverCache;let _;const f=l?e.filter:e.filter.getIndexedFilter();if(Pe(n))_=f.updateFullNode(d.getNode(),r,null);else if(f.filtersNodes()&&!d.isFiltered()){const e=d.getNode().updateChild(n,r);_=f.updateFullNode(d.getNode(),e,null)}else{const e=Oe(n);if(!d.isCompleteForPath(n)&&Te(n)>1)return t;const o=Ie(n),c=d.getNode().getImmediateChild(e).updateChild(o,r);_=".priority"===e?f.updatePriority(d.getNode(),c):f.updateChild(d.getNode(),e,c,o,Nn,null)}const m=Jt(t,_,d.isFullyInitialized()||Pe(n),f.filtersNodes());return Rn(e,m,n,o,new Pn(o,m,c),h)}function An(e,t,n,r,o,c,l){const h=t.eventCache;let d,_;const source=new Pn(o,t,c);if(Pe(n))_=e.filter.updateFullNode(t.eventCache.getNode(),r,l),d=Gt(t,_,!0,e.filter.filtersNodes());else{const o=Oe(n);if(".priority"===o)_=e.filter.updatePriority(t.eventCache.getNode(),r),d=Gt(t,_,h.isFullyInitialized(),h.isFiltered());else{const c=Ie(n),_=h.getNode().getImmediateChild(o);let f;if(Pe(c))f=r;else{const e=source.getCompleteChild(o);f=null!=e?".priority"===Ee(c)&&e.getChild(ke(c)).isEmpty()?e:e.updateChild(c,r):pt.EMPTY_NODE}if(_.equals(f))d=t;else{d=Gt(t,e.filter.updateChild(h.getNode(),o,f,c,source,l),h.isFullyInitialized(),e.filter.filtersNodes())}}}return d}function Dn(e,t){return e.eventCache.isCompleteForChild(t)}function Ln(e,t,n){return n.foreach(((e,n)=>{t=t.updateChild(e,n)})),t}function Fn(e,t,path,n,r,o,c,l){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let h,d=t;h=Pe(path)?n:new tn(null).setTree(path,n);const _=t.serverCache.getNode();return h.children.inorderTraversal(((n,h)=>{if(_.hasChild(n)){const _=Ln(0,t.serverCache.getNode().getImmediateChild(n),h);d=xn(e,d,new we(n),_,r,o,c,l)}})),h.children.inorderTraversal(((n,h)=>{const f=!t.serverCache.isCompleteForChild(n)&&null===h.value;if(!_.hasChild(n)&&!f){const _=Ln(0,t.serverCache.getNode().getImmediateChild(n),h);d=xn(e,d,new we(n),_,r,o,c,l)}})),d}class Mn{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new Ot(n.getIndex()),filter=(o=n).loadsAllData()?new Ot(o.getIndex()):o.hasLimit()?new It(o):new Tt(o);var o;this.processor_=function(filter){return{filter:filter}}(filter);const c=t.serverCache,l=t.eventCache,h=r.updateFullNode(pt.EMPTY_NODE,c.getNode(),null),d=filter.updateFullNode(pt.EMPTY_NODE,l.getNode(),null),_=new Qt(h,c.isFullyInitialized(),r.filtersNodes()),f=new Qt(d,l.isFullyInitialized(),filter.filtersNodes());this.viewCache_=Kt(f,_),this.eventGenerator_=new Yt(this.query_)}get query(){return this.query_}}function qn(view,path){const e=Zt(view.viewCache_);return e&&(view.query._queryParams.loadsAllData()||!Pe(path)&&!e.getImmediateChild(Oe(path)).isEmpty())?e.getChild(path):null}function Wn(view){return 0===view.eventRegistrations_.length}function zn(view,e,t){const n=[];if(t){Object(c.c)(null==e,"A cancel should cancel all event registrations.");const path=view.query._path;view.eventRegistrations_.forEach((e=>{const r=e.createCancelEvent(t,path);r&&n.push(r)}))}if(e){let t=[];for(let i=0;i<view.eventRegistrations_.length;++i){const n=view.eventRegistrations_[i];if(n.matches(e)){if(e.hasAnyCallback()){t=t.concat(view.eventRegistrations_.slice(i+1));break}}else t.push(n)}view.eventRegistrations_=t}else view.eventRegistrations_=[];return n}function Un(view,e,t,n){e.type===Wt.MERGE&&null!==e.source.queryId&&(Object(c.c)(Zt(view.viewCache_),"We should always have a full cache before handling merges"),Object(c.c)(Xt(view.viewCache_),"Missing event cache, even though we have a server cache"));const r=view.viewCache_,o=jn(view.processor_,r,e,t,n);var l,h;return l=view.processor_,h=o.viewCache,Object(c.c)(h.eventCache.getNode().isIndexed(l.filter.getIndex()),"Event snap not indexed"),Object(c.c)(h.serverCache.getNode().isIndexed(l.filter.getIndex()),"Server snap not indexed"),Object(c.c)(o.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),view.viewCache_=o.viewCache,Bn(view,o.changes,o.viewCache.eventCache.getNode(),null)}function Bn(view,e,t,n){const r=n?[n]:view.eventRegistrations_;return function(e,t,n,r){const o=[],c=[];return t.forEach((t=>{var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&c.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),$t(e,o,"child_removed",t,r,n),$t(e,o,"child_added",t,r,n),$t(e,o,"child_moved",c,r,n),$t(e,o,"child_changed",t,r,n),$t(e,o,"value",t,r,n),o}(view.eventGenerator_,e,t,r)}let Hn,Vn;class Qn{constructor(){this.views=new Map}}function Yn(e,t,n,r){const o=t.source.queryId;if(null!==o){const view=e.views.get(o);return Object(c.c)(null!=view,"SyncTree gave us an op for an invalid query."),Un(view,t,n,r)}{let o=[];for(const view of e.views.values())o=o.concat(Un(view,t,n,r));return o}}function $n(e,t,n,r,o){const c=t._queryIdentifier,view=e.views.get(c);if(!view){let e=bn(n,o?r:null),c=!1;e?c=!0:r instanceof pt?(e=wn(n,r),c=!1):(e=pt.EMPTY_NODE,c=!1);const l=Kt(new Qt(e,c,!1),new Qt(r,o,!1));return new Mn(t,l)}return view}function Kn(e,t,n,r,o,c){const view=$n(e,t,r,o,c);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,view),function(view,e){view.eventRegistrations_.push(e)}(view,n),function(view,e){const t=view.viewCache_.eventCache,n=[];t.getNode().isLeafNode()||t.getNode().forEachChild(st,((e,t)=>{n.push(bt(e,t))}));return t.isFullyInitialized()&&n.push(vt(t.getNode())),Bn(view,n,t.getNode(),e)}(view,n)}function Gn(e,t,n,r){const o=t._queryIdentifier,l=[];let h=[];const d=ti(e);if("default"===o)for(const[t,view]of e.views.entries())h=h.concat(zn(view,n,r)),Wn(view)&&(e.views.delete(t),view.query._queryParams.loadsAllData()||l.push(view.query));else{const view=e.views.get(o);view&&(h=h.concat(zn(view,n,r)),Wn(view)&&(e.views.delete(o),view.query._queryParams.loadsAllData()||l.push(view.query)))}return d&&!ti(e)&&l.push(new(Object(c.c)(Hn,"Reference.ts has not been loaded"),Hn)(t._repo,t._path)),{removed:l,events:h}}function Jn(e){const t=[];for(const view of e.views.values())view.query._queryParams.loadsAllData()||t.push(view);return t}function Xn(e,path){let t=null;for(const view of e.views.values())t=t||qn(view,path);return t}function Zn(e,t){if(t._queryParams.loadsAllData())return ni(e);{const n=t._queryIdentifier;return e.views.get(n)}}function ei(e,t){return null!=Zn(e,t)}function ti(e){return null!=ni(e)}function ni(e){for(const view of e.views.values())if(view.query._queryParams.loadsAllData())return view;return null}let ii=1;class ri{constructor(e){this.listenProvider_=e,this.syncPointTree_=new tn(null),this.pendingWriteTree_={visibleWrites:nn.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function si(e,path,t,n,r){return function(e,path,t,n,r){Object(c.c)(n>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),e.allWrites.push({path:path,snap:t,writeId:n,visible:r}),r&&(e.visibleWrites=rn(e.visibleWrites,path,t)),e.lastWriteId=n}(e.pendingWriteTree_,path,t,n,r),r?fi(e,new Ht({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},path,t)):[]}function oi(e,path,t,n){!function(e,path,t,n){Object(c.c)(n>e.lastWriteId,"Stacking an older merge on top of newer ones"),e.allWrites.push({path:path,children:t,writeId:n,visible:!0}),e.visibleWrites=sn(e.visibleWrites,path,t),e.lastWriteId=n}(e.pendingWriteTree_,path,t,n);const r=tn.fromObject(t);return fi(e,new Vt({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},path,r))}function ai(e,t,n=!1){const r=function(e,t){for(let i=0;i<e.allWrites.length;i++){const n=e.allWrites[i];if(n.writeId===t)return n}return null}(e.pendingWriteTree_,t);if(fn(e.pendingWriteTree_,t)){let t=new tn(null);return null!=r.snap?t=t.set(Ce(),!0):H(r.children,(e=>{t=t.set(new we(e),!0)})),fi(e,new Ut(r.path,t,n))}return[]}function ci(e,path,t){return fi(e,new Ht({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},path,t))}function hi(e,t,n,r,o=!1){const path=t._path,c=e.syncPointTree_.get(path);let l=[];if(c&&("default"===t._queryIdentifier||ei(c,t))){const h=Gn(c,t,n,r);0===c.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(path));const d=h.removed;if(l=h.events,!o){const n=-1!==d.findIndex((e=>e._queryParams.loadsAllData())),o=e.syncPointTree_.findOnPath(path,((e,t)=>ti(t)));if(n&&!o){const t=e.syncPointTree_.subtree(path);if(!t.isEmpty()){const n=function(e){return e.fold(((e,t,n)=>{if(t&&ti(t)){return[ni(t)]}{let e=[];return t&&(e=Jn(t)),H(n,((t,n)=>{e=e.concat(n)})),e}}))}(t);for(let i=0;i<n.length;++i){const view=n[i],t=view.query,r=yi(e,view);e.listenProvider_.startListening(Ti(t),vi(e,t),r.hashFn,r.onComplete)}}}if(!o&&d.length>0&&!r)if(n){const n=null;e.listenProvider_.stopListening(Ti(t),n)}else d.forEach((t=>{const n=e.queryToTagMap.get(bi(t));e.listenProvider_.stopListening(Ti(t),n)}))}!function(e,t){for(let n=0;n<t.length;++n){const r=t[n];if(!r._queryParams.loadsAllData()){const t=bi(r),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}}(e,d)}return l}function ui(e,path,t,n){const r=wi(e,n);if(null!=r){const n=Ci(r),o=n.path,c=n.queryId,l=je(o,path);return Oi(e,o,new Ht(zt(c),l,t))}return[]}function di(e,t,n,r=!1){const path=t._path;let o=null,l=!1;e.syncPointTree_.foreachOnPath(path,((e,t)=>{const n=je(e,path);o=o||Xn(t,n),l=l||ti(t)}));let h,d=e.syncPointTree_.get(path);if(d?(l=l||ti(d),o=o||Xn(d,Ce())):(d=new Qn,e.syncPointTree_=e.syncPointTree_.set(path,d)),null!=o)h=!0;else{h=!1,o=pt.EMPTY_NODE;e.syncPointTree_.subtree(path).foreachChild(((e,t)=>{const n=Xn(t,Ce());n&&(o=o.updateImmediateChild(e,n))}))}const _=ei(d,t);if(!_&&!t._queryParams.loadsAllData()){const n=bi(t);Object(c.c)(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");const r=ii++;e.queryToTagMap.set(n,r),e.tagToQueryMap.set(r,n)}let f=Kn(d,t,n,pn(e.pendingWriteTree_,path),o,h);if(!_&&!l&&!r){const view=Zn(d,t);f=f.concat(function(e,t,view){const path=t._path,n=vi(e,t),r=yi(e,view),o=e.listenProvider_.startListening(Ti(t),n,r.hashFn,r.onComplete),l=e.syncPointTree_.subtree(path);if(n)Object(c.c)(!ti(l.value),"If we're adding a query, it shouldn't be shadowed");else{const t=l.fold(((e,t,n)=>{if(!Pe(e)&&t&&ti(t))return[ni(t).query];{let e=[];return t&&(e=e.concat(Jn(t).map((view=>view.query)))),H(n,((t,n)=>{e=e.concat(n)})),e}}));for(let i=0;i<t.length;++i){const n=t[i];e.listenProvider_.stopListening(Ti(n),vi(e,n))}}return o}(e,t,view))}return f}function _i(e,path,t){const n=e.pendingWriteTree_,r=e.syncPointTree_.findOnPath(path,((e,t)=>{const n=Xn(t,je(e,path));if(n)return n}));return vn(n,path,r,t,!0)}function pi(e,t){const path=t._path;let n=null;e.syncPointTree_.foreachOnPath(path,((e,t)=>{const r=je(e,path);n=n||Xn(t,r)}));let r=e.syncPointTree_.get(path);r?n=n||Xn(r,Ce()):(r=new Qn,e.syncPointTree_=e.syncPointTree_.set(path,r));const o=null!=n,c=o?new Qt(n,!0,!1):null;return function(view){return Xt(view.viewCache_)}($n(r,t,pn(e.pendingWriteTree_,t._path),o?c.getNode():pt.EMPTY_NODE,o))}function fi(e,t){return gi(t,e.syncPointTree_,null,pn(e.pendingWriteTree_,Ce()))}function gi(e,t,n,r){if(Pe(e.path))return mi(e,t,n,r);{const o=t.get(Ce());null==n&&null!=o&&(n=Xn(o,Ce()));let c=[];const l=Oe(e.path),h=e.operationForChild(l),d=t.children.get(l);if(d&&h){const e=n?n.getImmediateChild(l):null,t=En(r,l);c=c.concat(gi(h,d,e,t))}return o&&(c=c.concat(Yn(o,e,r,n))),c}}function mi(e,t,n,r){const o=t.get(Ce());null==n&&null!=o&&(n=Xn(o,Ce()));let c=[];return t.children.inorderTraversal(((t,o)=>{const l=n?n.getImmediateChild(t):null,h=En(r,t),d=e.operationForChild(t);d&&(c=c.concat(mi(d,o,l,h)))})),o&&(c=c.concat(Yn(o,e,r,n))),c}function yi(e,view){const t=view.query,n=vi(e,t);return{hashFn:()=>{const e=function(view){return view.viewCache_.serverCache.getNode()}(view)||pt.EMPTY_NODE;return e.hash()},onComplete:r=>{if("ok"===r)return n?function(e,path,t){const n=wi(e,t);if(n){const t=Ci(n),r=t.path,o=t.queryId,c=je(r,path);return Oi(e,r,new Bt(zt(o),c))}return[]}(e,t._path,n):function(e,path){return fi(e,new Bt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},path))}(e,t._path);{const n=function(code,e){let t="Unknown Error";"too_big"===code?t="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===code?t="Client doesn't have permission to access the desired data.":"unavailable"===code&&(t="The service is unavailable");const n=new Error(code+" at "+e._path.toString()+": "+t);return n.code=code.toUpperCase(),n}(r,t);return hi(e,t,null,n)}}}}function vi(e,t){const n=bi(t);return e.queryToTagMap.get(n)}function bi(e){return e._path.toString()+"$"+e._queryIdentifier}function wi(e,t){return e.tagToQueryMap.get(t)}function Ci(e){const t=e.indexOf("$");return Object(c.c)(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new we(e.substr(0,t))}}function Oi(e,t,n){const r=e.syncPointTree_.get(t);Object(c.c)(r,"Missing sync point for query tag that we're tracking");return Yn(r,n,pn(e.pendingWriteTree_,t),null)}function Ti(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(Object(c.c)(Vn,"Reference.ts has not been loaded"),Vn)(e._repo,e._path):e}class Ii{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Ii(t)}node(){return this.node_}}class Ei{constructor(e,path){this.syncTree_=e,this.path_=path}getImmediateChild(e){const t=Ne(this.path_,e);return new Ei(this.syncTree_,t)}node(){return _i(this.syncTree_,this.path_)}}const Si=function(e,t,n){return e&&"object"==typeof e?(Object(c.c)(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?ki(e[".sv"],t,n):"object"==typeof e[".sv"]?Ni(e[".sv"],t):void Object(c.c)(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},ki=function(e,t,n){if("timestamp"===e)return n.timestamp;Object(c.c)(!1,"Unexpected server value: "+e)},Ni=function(e,t,n){e.hasOwnProperty("increment")||Object(c.c)(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const r=e.increment;"number"!=typeof r&&Object(c.c)(!1,"Unexpected increment value: "+r);const o=t.node();if(Object(c.c)(null!=o,"Expected ChildrenNode.EMPTY_NODE for nulls"),!o.isLeafNode())return r;const l=o.getValue();return"number"!=typeof l?r:l+r},Pi=function(path,e,t,n){return Ri(e,new Ei(t,path),n)},ji=function(e,t,n){return Ri(e,new Ii(t),n)};function Ri(e,t,n){const r=e.getPriority().val(),o=Si(r,t.getImmediateChild(".priority"),n);let c;if(e.isLeafNode()){const r=e,c=Si(r.getValue(),t,n);return c!==r.getValue()||o!==r.getPriority().val()?new it(c,gt(o)):e}{const r=e;return c=r,o!==r.getPriority().val()&&(c=c.updatePriority(new it(o))),r.forEachChild(st,((e,r)=>{const o=Ri(r,t.getImmediateChild(e),n);o!==r&&(c=c.updateImmediateChild(e,o))})),c}}class xi{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function Ai(e,t){let path=t instanceof we?t:new we(t),n=e,r=Oe(path);for(;null!==r;){const e=Object(c.v)(n.node.children,r)||{children:{},childCount:0};n=new xi(r,n,e),path=Ie(path),r=Oe(path)}return n}function Di(e){return e.node.value}function Li(e,t){e.node.value=t,zi(e)}function Fi(e){return e.node.childCount>0}function Mi(e,t){H(e.node.children,((n,r)=>{t(new xi(n,e,r))}))}function qi(e,t,n,r){n&&!r&&t(e),Mi(e,(e=>{qi(e,t,!0,r)})),n&&r&&t(e)}function Wi(e){return new we(null===e.parent?e.name:Wi(e.parent)+"/"+e.name)}function zi(e){null!==e.parent&&function(e,t,n){const r=function(e){return void 0===Di(e)&&!Fi(e)}(n),o=Object(c.g)(e.node.children,t);r&&o?(delete e.node.children[t],e.node.childCount--,zi(e)):r||o||(e.node.children[t]=n.node,e.node.childCount++,zi(e))}(e.parent,e.name,e)}const Ui=/[\[\].#$\/\u0000-\u001F\u007F]/,Bi=/[\[\].#$\u0000-\u001F\u007F]/,Hi=10485760,Vi=function(e){return"string"==typeof e&&0!==e.length&&!Ui.test(e)},Qi=function(e){return"string"==typeof e&&0!==e.length&&!Bi.test(e)},Yi=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!D(e)||e&&"object"==typeof e&&Object(c.g)(e,".sv")},$i=function(e,t,path,n){n&&void 0===t||Ki(Object(c.j)(e,"value"),t,path)},Ki=function(e,data,t){const path=t instanceof we?new De(t,e):t;if(void 0===data)throw new Error(e+"contains undefined "+Fe(path));if("function"==typeof data)throw new Error(e+"contains a function "+Fe(path)+" with contents = "+data.toString());if(D(data))throw new Error(e+"contains "+data.toString()+" "+Fe(path));if("string"==typeof data&&data.length>Hi/3&&Object(c.w)(data)>Hi)throw new Error(e+"contains a string greater than "+Hi+" utf8 bytes "+Fe(path)+" ('"+data.substring(0,50)+"...')");if(data&&"object"==typeof data){let t=!1,n=!1;if(H(data,((r,o)=>{if(".value"===r)t=!0;else if(".priority"!==r&&".sv"!==r&&(n=!0,!Vi(r)))throw new Error(e+" contains an invalid key ("+r+") "+Fe(path)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=Object(c.w)(t),Le(e)}(path,r),Ki(e,o,path),function(e){const t=e.parts_.pop();e.byteLength_-=Object(c.w)(t),e.parts_.length>0&&(e.byteLength_-=1)}(path)})),t&&n)throw new Error(e+' contains ".value" child '+Fe(path)+" in addition to actual children.")}},Gi=function(e,data,path,t){if(t&&void 0===data)return;const n=Object(c.j)(e,"values");if(!data||"object"!=typeof data||Array.isArray(data))throw new Error(n+" must be an object containing the children to replace.");const r=[];H(data,((e,t)=>{const o=new we(e);if(Ki(n,t,Ne(path,o)),".priority"===Ee(o)&&!Yi(t))throw new Error(n+"contains an invalid value for '"+o.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(o)})),function(e,t){let i,n;for(i=0;i<t.length;i++){n=t[i];const r=Se(n);for(let t=0;t<r.length;t++)if(".priority"===r[t]&&t===r.length-1);else if(!Vi(r[t]))throw new Error(e+"contains an invalid key ("+r[t]+") in path "+n.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(Re);let r=null;for(i=0;i<t.length;i++){if(n=t[i],null!==r&&Ae(r,n))throw new Error(e+"contains a path "+r.toString()+" that is ancestor of another path "+n.toString());r=n}}(n,r)},Ji=function(e,t,n){if(!n||void 0!==t){if(D(t))throw new Error(Object(c.j)(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Yi(t))throw new Error(Object(c.j)(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Xi=function(e,t,n,r){if(!(r&&void 0===n||Vi(n)))throw new Error(Object(c.j)(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},Zi=function(e,t,n,r){if(!(r&&void 0===n||Qi(n)))throw new Error(Object(c.j)(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},er=function(e,path){if(".info"===Oe(path))throw new Error(e+" failed = Can't modify data under /.info/")},nr=function(e,t){const n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Vi(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Qi(e)}(n))throw new Error(Object(c.j)(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class ir{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function rr(e,t){let n=null;for(let i=0;i<t.length;i++){const data=t[i],path=data.getPath();null===n||xe(path,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:path}),n.events.push(data)}n&&e.eventLists_.push(n)}function sr(e,path,t){rr(e,t),ar(e,(e=>xe(e,path)))}function or(e,t,n){rr(e,n),ar(e,(e=>Ae(e,t)||Ae(t,e)))}function ar(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){const r=e.eventLists_[i];if(r){t(r.path)?(cr(e.eventLists_[i]),e.eventLists_[i]=null):n=!1}}n&&(e.eventLists_=[]),e.recursionDepth_--}function cr(e){for(let i=0;i<e.events.length;i++){const t=e.events[i];if(null!==t){e.events[i]=null;const n=t.getEventRunner();S&&P("event: "+t.toString()),$(n)}}}const lr="repo_interrupt";class ur{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ir,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=At(),this.transactionQueueTree_=new xi,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function dr(e,t,n){if(e.stats_=le(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new Rt(e.repoInfo_,((t,data,n,r)=>{fr(e,t,data,n,r)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((()=>gr(e,!0)),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Object(c.y)(n)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new We(e.repoInfo_,t,((t,data,n,r)=>{fr(e,t,data,n,r)}),(t=>{gr(e,t)}),(t=>{!function(e,t){H(t,((t,n)=>{mr(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((t=>{e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((t=>{e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=function(e,t){const n=e.toString();return ce[n]||(ce[n]=t()),ce[n]}(e.repoInfo_,(()=>new qt(e.stats_,e.server_))),e.infoData_=new xt,e.infoSyncTree_=new ri({startListening:(t,n,r,o)=>{let c=[];const l=e.infoData_.getNode(t._path);return l.isEmpty()||(c=ci(e.infoSyncTree_,t._path,l),setTimeout((()=>{o("ok")}),0)),c},stopListening:()=>{}}),mr(e,"connected",!1),e.serverSyncTree_=new ri({startListening:(t,n,r,o)=>(e.server_.listen(t,r,n,((n,data)=>{const r=o(n,data);or(e.eventQueue_,t._path,r)})),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function _r(e){const t=e.infoData_.getNode(new we(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function pr(e){return(t=(t={timestamp:_r(e)})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t}function fr(e,t,data,n,r){e.dataUpdateCount++;const path=new we(t);data=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,data):data;let o=[];if(r)if(n){const t=Object(c.t)(data,(e=>gt(e)));o=function(e,path,t,n){const r=wi(e,n);if(r){const n=Ci(r),o=n.path,c=n.queryId,l=je(o,path),h=tn.fromObject(t);return Oi(e,o,new Vt(zt(c),l,h))}return[]}(e.serverSyncTree_,path,t,r)}else{const t=gt(data);o=ui(e.serverSyncTree_,path,t,r)}else if(n){const t=Object(c.t)(data,(e=>gt(e)));o=function(e,path,t){const n=tn.fromObject(t);return fi(e,new Vt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},path,n))}(e.serverSyncTree_,path,t)}else{const t=gt(data);o=ci(e.serverSyncTree_,path,t)}let l=path;o.length>0&&(l=Nr(e,path)),or(e.eventQueue_,l,o)}function gr(e,t){mr(e,"connected",t),!1===t&&function(e){Ir(e,"onDisconnectEvents");const t=pr(e),n=At();Ft(e.onDisconnect_,Ce(),((path,r)=>{const o=Pi(path,r,e.serverSyncTree_,t);Dt(n,path,o)}));let r=[];Ft(n,Ce(),((path,t)=>{r=r.concat(ci(e.serverSyncTree_,path,t));const n=Ar(e,path);Nr(e,n)})),e.onDisconnect_=At(),or(e.eventQueue_,Ce(),r)}(e)}function mr(e,t,n){const path=new we("/.info/"+t),r=gt(n);e.infoData_.updateSnapshot(path,r);const o=ci(e.infoSyncTree_,path,r);or(e.eventQueue_,path,o)}function yr(e){return e.nextWriteId_++}function vr(e,path,t,n,r){Ir(e,"set",{path:path.toString(),value:t,priority:n});const o=pr(e),c=gt(t,n),l=_i(e.serverSyncTree_,path),h=ji(c,l,o),d=yr(e),_=si(e.serverSyncTree_,path,h,d,!0);rr(e.eventQueue_,_),e.server_.put(path.toString(),c.val(!0),((t,n)=>{const o="ok"===t;o||A("set at "+path+" failed: "+t);const c=ai(e.serverSyncTree_,d,!o);or(e.eventQueue_,path,c),Er(e,r,t,n)}));const f=Ar(e,path);Nr(e,f),or(e.eventQueue_,f,[])}function wr(e,path,t){e.server_.onDisconnectCancel(path.toString(),((n,r)=>{"ok"===n&&Lt(e.onDisconnect_,path),Er(e,t,n,r)}))}function Cr(e,path,t,n){const r=gt(t);e.server_.onDisconnectPut(path.toString(),r.val(!0),((t,o)=>{"ok"===t&&Dt(e.onDisconnect_,path,r),Er(e,n,t,o)}))}function Or(e,t,n){let r;r=".info"===Oe(t._path)?hi(e.infoSyncTree_,t,n):hi(e.serverSyncTree_,t,n),sr(e.eventQueue_,t._path,r)}function Tr(e){e.persistentConnection_&&e.persistentConnection_.interrupt(lr)}function Ir(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),P(n,...t)}function Er(e,t,n,r){t&&$((()=>{if("ok"===n)t(null);else{const code=(n||"error").toUpperCase();let e=code;r&&(e+=": "+r);const o=new Error(e);o.code=code,t(o)}}))}function Sr(e,path,t){return _i(e.serverSyncTree_,path,t)||pt.EMPTY_NODE}function kr(e,t=e.transactionQueueTree_){if(t||xr(e,t),Di(t)){const n=jr(e,t);Object(c.c)(n.length>0,"Sending zero length transaction queue");n.every((e=>0===e.status))&&function(e,path,t){const n=t.map((e=>e.currentWriteId)),r=Sr(e,path,n);let o=r;const l=r.hash();for(let i=0;i<t.length;i++){const e=t[i];Object(c.c)(0===e.status,"tryToSendTransactionQueue_: items in queue should all be run."),e.status=1,e.retryCount++;const n=je(path,e.path);o=o.updateChild(n,e.currentOutputSnapshotRaw)}const h=o.val(!0),d=path;e.server_.put(d.toString(),h,(n=>{Ir(e,"transaction put response",{path:d.toString(),status:n});let r=[];if("ok"===n){const n=[];for(let i=0;i<t.length;i++)t[i].status=2,r=r.concat(ai(e.serverSyncTree_,t[i].currentWriteId)),t[i].onComplete&&n.push((()=>t[i].onComplete(null,!0,t[i].currentOutputSnapshotResolved))),t[i].unwatcher();xr(e,Ai(e.transactionQueueTree_,path)),kr(e,e.transactionQueueTree_),or(e.eventQueue_,path,r);for(let i=0;i<n.length;i++)$(n[i])}else{if("datastale"===n)for(let i=0;i<t.length;i++)3===t[i].status?t[i].status=4:t[i].status=0;else{A("transaction at "+d.toString()+" failed: "+n);for(let i=0;i<t.length;i++)t[i].status=4,t[i].abortReason=n}Nr(e,path)}}),l)}(e,Wi(t),n)}else Fi(t)&&Mi(t,(t=>{kr(e,t)}))}function Nr(e,t){const n=Pr(e,t),path=Wi(n);return function(e,t,path){if(0===t.length)return;const n=[];let r=[];const o=t.filter((q=>0===q.status)),l=o.map((q=>q.currentWriteId));for(let i=0;i<t.length;i++){const o=t[i],d=je(path,o.path);let _,f=!1;if(Object(c.c)(null!==d,"rerunTransactionsUnderNode_: relativePath should not be null."),4===o.status)f=!0,_=o.abortReason,r=r.concat(ai(e.serverSyncTree_,o.currentWriteId,!0));else if(0===o.status)if(o.retryCount>=25)f=!0,_="maxretry",r=r.concat(ai(e.serverSyncTree_,o.currentWriteId,!0));else{const n=Sr(e,o.path,l);o.currentInputSnapshot=n;const h=t[i].update(n.val());if(void 0!==h){Ki("transaction failed: Data returned ",h,o.path);let t=gt(h);"object"==typeof h&&null!=h&&Object(c.g)(h,".priority")||(t=t.updatePriority(n.getPriority()));const d=o.currentWriteId,_=pr(e),f=ji(t,n,_);o.currentOutputSnapshotRaw=t,o.currentOutputSnapshotResolved=f,o.currentWriteId=yr(e),l.splice(l.indexOf(d),1),r=r.concat(si(e.serverSyncTree_,o.path,f,o.currentWriteId,o.applyLocally)),r=r.concat(ai(e.serverSyncTree_,d,!0))}else f=!0,_="nodata",r=r.concat(ai(e.serverSyncTree_,o.currentWriteId,!0))}or(e.eventQueue_,path,r),r=[],f&&(t[i].status=2,h=t[i].unwatcher,setTimeout(h,Math.floor(0)),t[i].onComplete&&("nodata"===_?n.push((()=>t[i].onComplete(null,!1,t[i].currentInputSnapshot))):n.push((()=>t[i].onComplete(new Error(_),!1,null)))))}var h;xr(e,e.transactionQueueTree_);for(let i=0;i<n.length;i++)$(n[i]);kr(e,e.transactionQueueTree_)}(e,jr(e,n),path),path}function Pr(e,path){let t,n=e.transactionQueueTree_;for(t=Oe(path);null!==t&&void 0===Di(n);)n=Ai(n,t),t=Oe(path=Ie(path));return n}function jr(e,t){const n=[];return Rr(e,t,n),n.sort(((a,b)=>a.order-b.order)),n}function Rr(e,t,n){const r=Di(t);if(r)for(let i=0;i<r.length;i++)n.push(r[i]);Mi(t,(t=>{Rr(e,t,n)}))}function xr(e,t){const n=Di(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,Li(t,n.length>0?n:void 0)}Mi(t,(t=>{xr(e,t)}))}function Ar(e,path){const t=Wi(Pr(e,path)),n=Ai(e.transactionQueueTree_,path);return function(e,t,n){let r=n?e:e.parent;for(;null!==r;){if(t(r))return!0;r=r.parent}}(n,(t=>{Dr(e,t)})),Dr(e,n),qi(n,(t=>{Dr(e,t)})),t}function Dr(e,t){const n=Di(t);if(n){const r=[];let o=[],l=-1;for(let i=0;i<n.length;i++)3===n[i].status||(1===n[i].status?(Object(c.c)(l===i-1,"All SENT items should be at beginning of queue."),l=i,n[i].status=3,n[i].abortReason="set"):(Object(c.c)(0===n[i].status,"Unexpected transaction status in abort"),n[i].unwatcher(),o=o.concat(ai(e.serverSyncTree_,n[i].currentWriteId,!0)),n[i].onComplete&&r.push(n[i].onComplete.bind(null,new Error("set"),!1,null))));-1===l?Li(t,void 0):n.length=l+1,or(e.eventQueue_,Wi(t),o);for(let i=0;i<r.length;i++)$(r[i])}}const Lr=function(e,t){const n=Fr(e),r=n.namespace;"firebase.com"===n.domain&&x(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||x("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&A("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const o="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new re(n.host,n.secure,r,o,t,"",r!==n.subdomain),path:new we(n.pathString)}},Fr=function(e){let t="",n="",r="",o="",c="",l=!0,h="https",d=443;if("string"==typeof e){let _=e.indexOf("//");_>=0&&(h=e.substring(0,_-1),e=e.substring(_+2));let f=e.indexOf("/");-1===f&&(f=e.length);let m=e.indexOf("?");-1===m&&(m=e.length),t=e.substring(0,Math.min(f,m)),f<m&&(o=function(e){let t="";const n=e.split("/");for(let i=0;i<n.length;i++)if(n[i].length>0){let e=n[i];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(e){}t+="/"+e}return t}(e.substring(f,m)));const y=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const r=n.split("=");2===r.length?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):A(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,m)));_=t.indexOf(":"),_>=0?(l="https"===h||"wss"===h,d=parseInt(t.substring(_+1),10)):_=t.length;const v=t.slice(0,_);if("localhost"===v.toLowerCase())n="localhost";else if(v.split(".").length<=2)n=v;else{const e=t.indexOf(".");r=t.substring(0,e).toLowerCase(),n=t.substring(e+1),c=r}"ns"in y&&(c=y.ns)}return{host:t,port:d,domain:n,subdomain:r,secure:l,scheme:h,pathString:o,namespace:c}},Mr="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",qr=function(){let e=0;const t=[];return function(n){const r=n===e;let i;e=n;const o=new Array(8);for(i=7;i>=0;i--)o[i]=Mr.charAt(n%64),n=Math.floor(n/64);Object(c.c)(0===n,"Cannot push at time == 0");let l=o.join("");if(r){for(i=11;i>=0&&63===t[i];i--)t[i]=0;t[i]++}else for(i=0;i<12;i++)t[i]=Math.floor(64*Math.random());for(i=0;i<12;i++)l+=Mr.charAt(t[i]);return Object(c.c)(20===l.length,"nextPushId: Length should be 20."),l}}();class Wr{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Object(c.y)(this.snapshot.exportVal())}}class zr{constructor(e,t,path){this.eventRegistration=e,this.error=t,this.path=path}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class Ur{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return Object(c.c)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class Br{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new c.a;return wr(this._repo,this._path,e.wrapCallback((()=>{}))),e.promise}remove(){er("OnDisconnect.remove",this._path);const e=new c.a;return Cr(this._repo,this._path,null,e.wrapCallback((()=>{}))),e.promise}set(e){er("OnDisconnect.set",this._path),$i("OnDisconnect.set",e,this._path,!1);const t=new c.a;return Cr(this._repo,this._path,e,t.wrapCallback((()=>{}))),t.promise}setWithPriority(e,t){er("OnDisconnect.setWithPriority",this._path),$i("OnDisconnect.setWithPriority",e,this._path,!1),Ji("OnDisconnect.setWithPriority",t,!1);const n=new c.a;return function(e,path,t,n,r){const o=gt(t,n);e.server_.onDisconnectPut(path.toString(),o.val(!0),((t,n)=>{"ok"===t&&Dt(e.onDisconnect_,path,o),Er(0,r,t,n)}))}(this._repo,this._path,e,t,n.wrapCallback((()=>{}))),n.promise}update(e){er("OnDisconnect.update",this._path),Gi("OnDisconnect.update",e,this._path,!1);const t=new c.a;return function(e,path,t,n){if(Object(c.n)(t))return P("onDisconnect().update() called with empty data.  Don't do anything."),void Er(0,n,"ok",void 0);e.server_.onDisconnectMerge(path.toString(),t,((r,o)=>{"ok"===r&&H(t,((t,n)=>{const r=gt(n);Dt(e.onDisconnect_,Ne(path,t),r)})),Er(0,n,r,o)}))}(this._repo,this._path,e,t.wrapCallback((()=>{}))),t.promise}}class Hr{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return Pe(this._path)?null:Ee(this._path)}get ref(){return new $r(this._repo,this._path)}get _queryIdentifier(){const e=jt(this._queryParams),t=U(e);return"{}"===t?"default":t}get _queryObject(){return jt(this._queryParams)}isEqual(e){if(!((e=Object(c.l)(e))instanceof Hr))return!1;const t=this._repo===e._repo,n=xe(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(path){let e="";for(let i=path.pieceNum_;i<path.pieces_.length;i++)""!==path.pieces_[i]&&(e+="/"+encodeURIComponent(String(path.pieces_[i])));return e||"/"}(this._path)}}function Vr(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function Qr(e){let t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===Ve){const r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",o="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==L)throw new Error(r);if("string"!=typeof t)throw new Error(o)}if(e.hasEnd()){if(e.getIndexEndName()!==F)throw new Error(r);if("string"!=typeof n)throw new Error(o)}}else if(e.getIndex()===st){if(null!=t&&!Yi(t)||null!=n&&!Yi(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(Object(c.c)(e.getIndex()instanceof mt||e.getIndex()===yt,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Yr(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class $r extends Hr{constructor(e,path){super(e,path,new Et,!1)}get parent(){const e=ke(this._path);return null===e?null:new $r(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class Kr{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(path){const e=new we(path),t=Xr(this.ref,path);return new Kr(this._node.getChild(e),t,st)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){if(this._node.isLeafNode())return!1;return!!this._node.forEachChild(this._index,((t,n)=>e(new Kr(n,Xr(this.ref,t),st))))}hasChild(path){const e=new we(path);return!this._node.getChild(e).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Gr(e,path){return(e=Object(c.l)(e))._checkNotDeleted("ref"),void 0!==path?Xr(e._root,path):e._root}function Jr(e,t){(e=Object(c.l)(e))._checkNotDeleted("refFromURL");const n=Lr(t,e._repo.repoInfo_.nodeAdmin);nr("refFromURL",n);const r=n.repoInfo;return e._repo.repoInfo_.isCustomHost()||r.host===e._repo.repoInfo_.host||x("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+e._repo.repoInfo_.host+")"),Gr(e,n.path.toString())}function Xr(e,path){var t,n,r,o;return null===Oe((e=Object(c.l)(e))._path)?(t="child",n="path",o=!1,(r=path)&&(r=r.replace(/^\/*\.info(\/|$)/,"/")),Zi(t,n,r,o)):Zi("child","path",path,!1),new $r(e._repo,Ne(e._path,path))}function Zr(e,t){e=Object(c.l)(e),er("push",e._path),$i("push",t,e._path,!0);const n=_r(e._repo),r=qr(n),o=Xr(e,r),l=Xr(e,r);let h;return h=null!=t?ts(l,t).then((()=>l)):Promise.resolve(l),o.then=h.then.bind(h),o.catch=h.then.bind(h,void 0),o}function es(e){return er("remove",e._path),ts(e,null)}function ts(e,t){e=Object(c.l)(e),er("set",e._path),$i("set",t,e._path,!1);const n=new c.a;return vr(e._repo,e._path,t,null,n.wrapCallback((()=>{}))),n.promise}function ns(e,t){e=Object(c.l)(e),er("setPriority",e._path),Ji("setPriority",t,!1);const n=new c.a;return vr(e._repo,Ne(e._path,".priority"),t,null,n.wrapCallback((()=>{}))),n.promise}function is(e,t,n){if(er("setWithPriority",e._path),$i("setWithPriority",t,e._path,!1),Ji("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";const r=new c.a;return vr(e._repo,e._path,t,n,r.wrapCallback((()=>{}))),r.promise}function rs(e,t){Gi("update",t,e._path,!1);const n=new c.a;return function(e,path,t,n){Ir(e,"update",{path:path.toString(),value:t});let r=!0;const o=pr(e),c={};if(H(t,((t,n)=>{r=!1,c[t]=Pi(Ne(path,t),gt(n),e.serverSyncTree_,o)})),r)P("update() called with empty data.  Don't do anything."),Er(0,n,"ok",void 0);else{const r=yr(e),o=oi(e.serverSyncTree_,path,c,r);rr(e.eventQueue_,o),e.server_.merge(path.toString(),t,((t,o)=>{const c="ok"===t;c||A("update at "+path+" failed: "+t);const l=ai(e.serverSyncTree_,r,!c),h=l.length>0?Nr(e,path):path;or(e.eventQueue_,h,l),Er(0,n,t,o)})),H(t,(t=>{const n=Ar(e,Ne(path,t));Nr(e,n)})),or(e.eventQueue_,path,[])}}(e._repo,e._path,t,n.wrapCallback((()=>{}))),n.promise}function ss(e){e=Object(c.l)(e);const t=new Ur((()=>{})),n=new os(t);return function(e,t,n){const r=pi(e.serverSyncTree_,t);return null!=r?Promise.resolve(r):e.server_.get(t).then((r=>{const o=gt(r).withIndex(t._queryParams.getIndex());let c;if(di(e.serverSyncTree_,t,n,!0),t._queryParams.loadsAllData())c=ci(e.serverSyncTree_,t._path,o);else{const n=vi(e.serverSyncTree_,t);c=ui(e.serverSyncTree_,t._path,o,n)}return or(e.eventQueue_,t._path,c),hi(e.serverSyncTree_,t,n,null,!0),o}),(n=>(Ir(e,"get for query "+Object(c.y)(t)+" failed: "+n),Promise.reject(new Error(n)))))}(e._repo,e,n).then((t=>new Kr(t,new $r(e._repo,e._path),e._queryParams.getIndex())))}class os{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const n=t._queryParams.getIndex();return new Wr("value",this,new Kr(e.snapshotNode,new $r(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,path){return this.callbackContext.hasCancelCallback?new zr(this,e,path):null}matches(e){return e instanceof os&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class as{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,path){return this.callbackContext.hasCancelCallback?new zr(this,e,path):null}createEvent(e,t){Object(c.c)(null!=e.childName,"Child events should have a childName.");const n=Xr(new $r(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new Wr(e.type,this,new Kr(e.snapshotNode,n,r),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof as&&(this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)))}hasAnyCallback(){return!!this.callbackContext}}function cs(e,t,n,r,o){let c;if("object"==typeof r&&(c=void 0,o=r),"function"==typeof r&&(c=r),o&&o.onlyOnce){const t=n,r=(n,r)=>{Or(e._repo,e,h),t(n,r)};r.userCallback=n.userCallback,r.context=n.context,n=r}const l=new Ur(n,c||void 0),h="value"===t?new os(l):new as(t,l);return function(e,t,n){let r;r=".info"===Oe(t._path)?di(e.infoSyncTree_,t,n):di(e.serverSyncTree_,t,n),sr(e.eventQueue_,t._path,r)}(e._repo,e,h),()=>Or(e._repo,e,h)}function ls(e,t,n,r){return cs(e,"value",t,n,r)}function hs(e,t,n,r){return cs(e,"child_added",t,n,r)}function us(e,t,n,r){return cs(e,"child_changed",t,n,r)}function ds(e,t,n,r){return cs(e,"child_moved",t,n,r)}function _s(e,t,n,r){return cs(e,"child_removed",t,n,r)}function ps(e,t,n){let r=null;const o=n?new Ur(n):null;"value"===t?r=new os(o):t&&(r=new as(t,o)),Or(e._repo,e,r)}class fs{}class gs extends fs{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){$i("endAt",this._value,e._path,!0);const t=kt(e._queryParams,this._value,this._key);if(Yr(t),Qr(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Hr(e._repo,e._path,t,e._orderByCalled)}}function ms(e,t){return Xi("endAt","key",t,!0),new gs(e,t)}class ys extends fs{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){$i("endBefore",this._value,e._path,!1);const t=function(e,t,n){let r;return r=e.index_===Ve||n?kt(e,t,n):kt(e,t,L),r.endBeforeSet_=!0,r}(e._queryParams,this._value,this._key);if(Yr(t),Qr(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Hr(e._repo,e._path,t,e._orderByCalled)}}function vs(e,t){return Xi("endBefore","key",t,!0),new ys(e,t)}class bs extends fs{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){$i("startAt",this._value,e._path,!0);const t=St(e._queryParams,this._value,this._key);if(Yr(t),Qr(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Hr(e._repo,e._path,t,e._orderByCalled)}}function ws(e=null,t){return Xi("startAt","key",t,!0),new bs(e,t)}class Cs extends fs{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){$i("startAfter",this._value,e._path,!1);const t=function(e,t,n){let r;return r=e.index_===Ve||n?St(e,t,n):St(e,t,F),r.startAfterSet_=!0,r}(e._queryParams,this._value,this._key);if(Yr(t),Qr(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Hr(e._repo,e._path,t,e._orderByCalled)}}function Os(e,t){return Xi("startAfter","key",t,!0),new Cs(e,t)}class Ts extends fs{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Hr(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="l",n}(e._queryParams,this._limit),e._orderByCalled)}}function Is(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new Ts(e)}class Es extends fs{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Hr(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="r",n}(e._queryParams,this._limit),e._orderByCalled)}}function Ss(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new Es(e)}class ks extends fs{constructor(e){super(),this._path=e}_apply(e){Vr(e,"orderByChild");const t=new we(this._path);if(Pe(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const n=new mt(t),r=Nt(e._queryParams,n);return Qr(r),new Hr(e._repo,e._path,r,!0)}}function Ns(path){if("$key"===path)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===path)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===path)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Zi("orderByChild","path",path,!1),new ks(path)}class Ps extends fs{_apply(e){Vr(e,"orderByKey");const t=Nt(e._queryParams,Ve);return Qr(t),new Hr(e._repo,e._path,t,!0)}}function js(){return new Ps}class Rs extends fs{_apply(e){Vr(e,"orderByPriority");const t=Nt(e._queryParams,st);return Qr(t),new Hr(e._repo,e._path,t,!0)}}function xs(){return new Rs}class As extends fs{_apply(e){Vr(e,"orderByValue");const t=Nt(e._queryParams,yt);return Qr(t),new Hr(e._repo,e._path,t,!0)}}function Ds(){return new As}class Ls extends fs{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){if($i("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new gs(this._value,this._key)._apply(new bs(this._value,this._key)._apply(e))}}function Fs(e,t){return Xi("equalTo","key",t,!0),new Ls(e,t)}function Ms(e,...t){let n=Object(c.l)(e);for(const e of t)n=e._apply(n);return n}!function(e){Object(c.c)(!Hn,"__referenceConstructor has already been defined"),Hn=e}($r),function(e){Object(c.c)(!Vn,"__referenceConstructor has already been defined"),Vn=e}($r);const qs={};let Ws=!1;function zs(t,n,r,o,c){let l=o||t.options.databaseURL;void 0===l&&(t.options.projectId||x("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),P("Using default host for project ",t.options.projectId),l=`${t.options.projectId}-default-rtdb.firebaseio.com`);let h,d,_=Lr(l,c),f=_.repoInfo;void 0!==e&&e.env&&(d=e.env.FIREBASE_DATABASE_EMULATOR_HOST),d?(h=!0,l=`http://${d}?ns=${f.namespace}`,_=Lr(l,c),f=_.repoInfo):h=!_.repoInfo.secure;const m=c&&h?new X(X.OWNER):new J(t.name,t.options,n);nr("Invalid Firebase Database URL",_),Pe(_.path)||x("Database URL must point to the root of a Firebase Database (not including a child path).");const y=function(e,t,n,r){let o=qs[t.name];o||(o={},qs[t.name]=o);let c=o[e.toURLString()];c&&x("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return c=new ur(e,Ws,n,r),o[e.toURLString()]=c,c}(f,t,m,new G(t.name,r));return new Us(y,t)}class Us{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(dr(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new $r(this._repo,Ce())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(e,t){const n=qs[t];n&&n[e.key]===e||x(`Database ${t}(${e.repoInfo_}) has already been deleted.`),Tr(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&x("Cannot call "+e+" on a deleted database.")}}function Bs(){ge.IS_TRANSPORT_INITIALIZED&&A("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function Hs(){Bs(),de.forceDisallow()}function Vs(){Bs(),fe.forceDisallow(),de.forceAllow()}function Qs(e,t,n,r={}){(e=Object(c.l)(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&x("Cannot call useEmulator() after instance has already been initialized.");const o=e._repoInternal;let l;if(o.repoInfo_.nodeAdmin)r.mockUserToken&&x('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),l=new X(X.OWNER);else if(r.mockUserToken){const t="string"==typeof r.mockUserToken?r.mockUserToken:Object(c.h)(r.mockUserToken,e.app.options.projectId);l=new X(t)}!function(e,t,n,r){e.repoInfo_=new re(`${t}:${n}`,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams),r&&(e.authTokenProvider_=r)}(o,t,n,l)}function Ys(e){(e=Object(c.l)(e))._checkNotDeleted("goOffline"),Tr(e._repo)}function $s(e){var t;(e=Object(c.l)(e))._checkNotDeleted("goOnline"),(t=e._repo).persistentConnection_&&t.persistentConnection_.resume(lr)}function Ks(e,t){N(e,t)}const Gs={".sv":"timestamp"};function Js(){return Gs}function Xs(e){return{".sv":{increment:e}}}class Zs{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function eo(e,t,n){var r;if(e=Object(c.l)(e),er("Reference.transaction",e._path),".length"===e.key||".keys"===e.key)throw"Reference.transaction failed: "+e.key+" is a read-only object.";const o=null===(r=null==n?void 0:n.applyLocally)||void 0===r||r,l=new c.a,h=ls(e,(()=>{}));return function(e,path,t,n,r,o){Ir(e,"transaction on "+path);const l={path:path,update:t,onComplete:n,status:null,order:T(),applyLocally:o,retryCount:0,unwatcher:r,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},h=Sr(e,path,void 0);l.currentInputSnapshot=h;const d=l.update(h.val());if(void 0===d)l.unwatcher(),l.currentOutputSnapshotRaw=null,l.currentOutputSnapshotResolved=null,l.onComplete&&l.onComplete(null,!1,l.currentInputSnapshot);else{Ki("transaction failed: Data returned ",d,l.path),l.status=0;const t=Ai(e.transactionQueueTree_,path),n=Di(t)||[];let r;n.push(l),Li(t,n),"object"==typeof d&&null!==d&&Object(c.g)(d,".priority")?(r=Object(c.v)(d,".priority"),Object(c.c)(Yi(r),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):r=(_i(e.serverSyncTree_,path)||pt.EMPTY_NODE).getPriority().val();const o=pr(e),_=gt(d,r),f=ji(_,h,o);l.currentOutputSnapshotRaw=_,l.currentOutputSnapshotResolved=f,l.currentWriteId=yr(e);const m=si(e.serverSyncTree_,path,f,l.currentWriteId,l.applyLocally);or(e.eventQueue_,path,m),kr(e,e.transactionQueueTree_)}}(e._repo,e._path,t,((t,n,r)=>{let o=null;t?l.reject(t):(o=new Kr(r,new $r(e._repo,e._path),st),l.resolve(new Zs(n,o)))}),h,o),l.promise}We.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},We.prototype.echo=function(data,e){this.sendRequest("echo",{d:data},e)};var to;f(r.SDK_VERSION),Object(r._registerComponent)(new o.a("database",((e,{instanceIdentifier:t})=>zs(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)),"PUBLIC").setMultipleInstances(!0)),Object(r.registerVersion)(h,d,to),Object(r.registerVersion)(h,d,"esm2017")}).call(this,n(108))},331:function(e,t,n){"use strict";n.r(t);var r=n(302),o=n(309),c=n(318),l=n(306),h=n(310);const d=new h.b("@firebase/database-compat"),_=function(e){const t="FIREBASE WARNING: "+e;d.warn(t)};class f{constructor(e){this._delegate=e}cancel(e){Object(l.z)("OnDisconnect.cancel",0,1,arguments.length),Object(l.A)("OnDisconnect.cancel","onComplete",e,!0);const t=this._delegate.cancel();return e&&t.then((()=>e(null)),(t=>e(t))),t}remove(e){Object(l.z)("OnDisconnect.remove",0,1,arguments.length),Object(l.A)("OnDisconnect.remove","onComplete",e,!0);const t=this._delegate.remove();return e&&t.then((()=>e(null)),(t=>e(t))),t}set(e,t){Object(l.z)("OnDisconnect.set",1,2,arguments.length),Object(l.A)("OnDisconnect.set","onComplete",t,!0);const n=this._delegate.set(e);return t&&n.then((()=>t(null)),(e=>t(e))),n}setWithPriority(e,t,n){Object(l.z)("OnDisconnect.setWithPriority",2,3,arguments.length),Object(l.A)("OnDisconnect.setWithPriority","onComplete",n,!0);const r=this._delegate.setWithPriority(e,t);return n&&r.then((()=>n(null)),(e=>n(e))),r}update(e,t){if(Object(l.z)("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){const t={};for(let i=0;i<e.length;++i)t[""+i]=e[i];e=t,_("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Object(l.A)("OnDisconnect.update","onComplete",t,!0);const n=this._delegate.update(e);return t&&n.then((()=>t(null)),(e=>t(e))),n}}class m{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return Object(l.z)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class y{constructor(e,t){this._database=e,this._delegate=t}val(){return Object(l.z)("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return Object(l.z)("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return Object(l.z)("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return Object(l.z)("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(path){return Object(l.z)("DataSnapshot.child",0,1,arguments.length),path=String(path),Object(c.g)("DataSnapshot.child","path",path,!1),new y(this._database,this._delegate.child(path))}hasChild(path){return Object(l.z)("DataSnapshot.hasChild",1,1,arguments.length),Object(c.g)("DataSnapshot.hasChild","path",path,!1),this._delegate.hasChild(path)}getPriority(){return Object(l.z)("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return Object(l.z)("DataSnapshot.forEach",1,1,arguments.length),Object(l.A)("DataSnapshot.forEach","action",e,!1),this._delegate.forEach((t=>e(new y(this._database,t))))}hasChildren(){return Object(l.z)("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return Object(l.z)("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return Object(l.z)("DataSnapshot.ref",0,0,arguments.length),new w(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class v{constructor(e,t){this.database=e,this._delegate=t}on(e,t,n,r){var o;Object(l.z)("Query.on",2,4,arguments.length),Object(l.A)("Query.on","callback",t,!1);const h=v.getCancelAndContextArgs_("Query.on",n,r),d=(e,n)=>{t.call(h.context,new y(this.database,e),n)};d.userCallback=t,d.context=h.context;const _=null===(o=h.cancel)||void 0===o?void 0:o.bind(h.context);switch(e){case"value":return Object(c.B)(this._delegate,d,_),t;case"child_added":return Object(c.x)(this._delegate,d,_),t;case"child_removed":return Object(c.A)(this._delegate,d,_),t;case"child_changed":return Object(c.y)(this._delegate,d,_),t;case"child_moved":return Object(c.z)(this._delegate,d,_),t;default:throw new Error(Object(l.j)("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,n){if(Object(l.z)("Query.off",0,3,arguments.length),function(e,t,n){if(!n||void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Object(l.j)(e,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}("Query.off",e,!0),Object(l.A)("Query.off","callback",t,!0),Object(l.B)("Query.off","context",n,!0),t){const r=()=>{};r.userCallback=t,r.context=n,Object(c.w)(this._delegate,e,r)}else Object(c.w)(this._delegate,e)}get(){return Object(c.q)(this._delegate).then((e=>new y(this.database,e)))}once(e,t,n,r){Object(l.z)("Query.once",1,4,arguments.length),Object(l.A)("Query.once","callback",t,!0);const o=v.getCancelAndContextArgs_("Query.once",n,r),h=new l.a,d=(e,n)=>{const r=new y(this.database,e);t&&t.call(o.context,r,n),h.resolve(r)};d.userCallback=t,d.context=o.context;const _=e=>{o.cancel&&o.cancel.call(o.context,e),h.reject(e)};switch(e){case"value":Object(c.B)(this._delegate,d,_,{onlyOnce:!0});break;case"child_added":Object(c.x)(this._delegate,d,_,{onlyOnce:!0});break;case"child_removed":Object(c.A)(this._delegate,d,_,{onlyOnce:!0});break;case"child_changed":Object(c.y)(this._delegate,d,_,{onlyOnce:!0});break;case"child_moved":Object(c.z)(this._delegate,d,_,{onlyOnce:!0});break;default:throw new Error(Object(l.j)("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return h.promise}limitToFirst(e){return Object(l.z)("Query.limitToFirst",1,1,arguments.length),new v(this.database,Object(c.H)(this._delegate,Object(c.u)(e)))}limitToLast(e){return Object(l.z)("Query.limitToLast",1,1,arguments.length),new v(this.database,Object(c.H)(this._delegate,Object(c.v)(e)))}orderByChild(path){return Object(l.z)("Query.orderByChild",1,1,arguments.length),new v(this.database,Object(c.H)(this._delegate,Object(c.C)(path)))}orderByKey(){return Object(l.z)("Query.orderByKey",0,0,arguments.length),new v(this.database,Object(c.H)(this._delegate,Object(c.D)()))}orderByPriority(){return Object(l.z)("Query.orderByPriority",0,0,arguments.length),new v(this.database,Object(c.H)(this._delegate,Object(c.E)()))}orderByValue(){return Object(l.z)("Query.orderByValue",0,0,arguments.length),new v(this.database,Object(c.H)(this._delegate,Object(c.F)()))}startAt(e=null,t){return Object(l.z)("Query.startAt",0,2,arguments.length),new v(this.database,Object(c.H)(this._delegate,Object(c.R)(e,t)))}startAfter(e=null,t){return Object(l.z)("Query.startAfter",0,2,arguments.length),new v(this.database,Object(c.H)(this._delegate,Object(c.Q)(e,t)))}endAt(e=null,t){return Object(l.z)("Query.endAt",0,2,arguments.length),new v(this.database,Object(c.H)(this._delegate,Object(c.l)(e,t)))}endBefore(e=null,t){return Object(l.z)("Query.endBefore",0,2,arguments.length),new v(this.database,Object(c.H)(this._delegate,Object(c.m)(e,t)))}equalTo(e,t){return Object(l.z)("Query.equalTo",1,2,arguments.length),new v(this.database,Object(c.H)(this._delegate,Object(c.n)(e,t)))}toString(){return Object(l.z)("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return Object(l.z)("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(Object(l.z)("Query.isEqual",1,1,arguments.length),!(e instanceof v)){throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,n){const r={cancel:void 0,context:void 0};if(t&&n)r.cancel=t,Object(l.A)(e,"cancel",r.cancel,!0),r.context=n,Object(l.B)(e,"context",r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(Object(l.j)(e,"cancelOrContext")+" must either be a cancel callback or a context object.");r.cancel=t}return r}get ref(){return new w(this.database,new c.d(this._delegate._repo,this._delegate._path))}}class w extends v{constructor(e,t){super(e,new c.b(t._repo,t._path,new c.c,!1)),this.database=e,this._delegate=t}getKey(){return Object(l.z)("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return Object(l.z)("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new w(this.database,Object(c.i)(this._delegate,e))}getParent(){Object(l.z)("Reference.parent",0,0,arguments.length);const e=this._delegate.parent;return e?new w(this.database,e):null}getRoot(){return Object(l.z)("Reference.root",0,0,arguments.length),new w(this.database,this._delegate.root)}set(e,t){Object(l.z)("Reference.set",1,2,arguments.length),Object(l.A)("Reference.set","onComplete",t,!0);const n=Object(c.N)(this._delegate,e);return t&&n.then((()=>t(null)),(e=>t(e))),n}update(e,t){if(Object(l.z)("Reference.update",1,2,arguments.length),Array.isArray(e)){const t={};for(let i=0;i<e.length;++i)t[""+i]=e[i];e=t,_("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Object(c.h)("Reference.update",this._delegate._path),Object(l.A)("Reference.update","onComplete",t,!0);const n=Object(c.S)(this._delegate,e);return t&&n.then((()=>t(null)),(e=>t(e))),n}setWithPriority(e,t,n){Object(l.z)("Reference.setWithPriority",2,3,arguments.length),Object(l.A)("Reference.setWithPriority","onComplete",n,!0);const r=Object(c.P)(this._delegate,e,t);return n&&r.then((()=>n(null)),(e=>n(e))),r}remove(e){Object(l.z)("Reference.remove",0,1,arguments.length),Object(l.A)("Reference.remove","onComplete",e,!0);const t=Object(c.K)(this._delegate);return e&&t.then((()=>e(null)),(t=>e(t))),t}transaction(e,t,n){Object(l.z)("Reference.transaction",1,3,arguments.length),Object(l.A)("Reference.transaction","transactionUpdate",e,!1),Object(l.A)("Reference.transaction","onComplete",t,!0),function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Object(l.j)(e,t)+"must be a boolean.")}("Reference.transaction","applyLocally",n,!0);const r=Object(c.L)(this._delegate,e,{applyLocally:n}).then((e=>new m(e.committed,new y(this.database,e.snapshot))));return t&&r.then((e=>t(null,e.committed,e.snapshot)),(e=>t(e,!1,null))),r}setPriority(e,t){Object(l.z)("Reference.setPriority",1,2,arguments.length),Object(l.A)("Reference.setPriority","onComplete",t,!0);const n=Object(c.O)(this._delegate,e);return t&&n.then((()=>t(null)),(e=>t(e))),n}push(e,t){Object(l.z)("Reference.push",0,2,arguments.length),Object(l.A)("Reference.push","onComplete",t,!0);const n=Object(c.G)(this._delegate,e),r=n.then((e=>new w(this.database,e)));t&&r.then((()=>t(null)),(e=>t(e)));const o=new w(this.database,n);return o.then=r.then.bind(r),o.catch=r.catch.bind(r,void 0),o}onDisconnect(){return Object(c.h)("Reference.onDisconnect",this._delegate._path),new f(new c.a(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class C{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:c.p,forceLongPolling:c.o}}useEmulator(e,t,n={}){Object(c.j)(this._delegate,e,t,n)}ref(path){if(Object(l.z)("database.ref",0,1,arguments.length),path instanceof w){const e=Object(c.J)(this._delegate,path.toString());return new w(this,e)}{const e=Object(c.I)(this._delegate,path);return new w(this,e)}}refFromURL(e){Object(l.z)("database.refFromURL",1,1,arguments.length);const t=Object(c.J)(this._delegate,e);return new w(this,t)}goOffline(){return Object(l.z)("database.goOffline",0,0,arguments.length),Object(c.r)(this._delegate)}goOnline(){return Object(l.z)("database.goOnline",0,0,arguments.length),Object(c.s)(this._delegate)}}C.ServerValue={TIMESTAMP:Object(c.M)(),increment:e=>Object(c.t)(e)};var O=Object.freeze({__proto__:null,initStandalone:function({app:e,url:t,version:n,customAuthImpl:r,namespace:l,nodeAdmin:h=!1}){Object(c.f)(n);const d=new o.c("auth-internal",new o.b("database-standalone"));return d.setComponent(new o.a("auth-internal",(()=>r),"PRIVATE")),{instance:new C(Object(c.e)(e,d,void 0,t,h),e),namespace:l}}});const T=C.ServerValue;var I;(I=r.a).INTERNAL.registerComponent(new o.a("database-compat",((e,{instanceIdentifier:t})=>{const n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("database").getImmediate({identifier:t});return new C(r,n)}),"PUBLIC").setServiceProps({Reference:w,Query:v,Database:C,DataSnapshot:y,enableLogging:c.k,INTERNAL:O,ServerValue:T}).setMultipleInstances(!0)),I.registerVersion("@firebase/database-compat","0.3.1")}}]);